assert(load(Base64Decode("G0x1YVIAAQQEBAgAGZMNChoKAAAAAAAAAAAAAQIKAAAABgBAAEFAAAAdQAABBkBAAGUAAAAKQACBBkBAAGVAAAAKQICBHwCAAAQAAAAEBgAAAGNsYXNzAAQNAAAAU2NyaXB0U3RhdHVzAAQHAAAAX19pbml0AAQLAAAAU2VuZFVwZGF0ZQACAAAAAgAAAAgAAAACAAotAAAAhkBAAMaAQAAGwUAABwFBAkFBAQAdgQABRsFAAEcBwQKBgQEAXYEAAYbBQACHAUEDwcEBAJ2BAAHGwUAAxwHBAwECAgDdgQABBsJAAAcCQQRBQgIAHYIAARYBAgLdAAABnYAAAAqAAIAKQACFhgBDAMHAAgCdgAABCoCAhQqAw4aGAEQAx8BCAMfAwwHdAIAAnYAAAAqAgIeMQEQAAYEEAJ1AgAGGwEQA5QAAAJ1AAAEfAIAAFAAAAAQFAAAAaHdpZAAEDQAAAEJhc2U2NEVuY29kZQAECQAAAHRvc3RyaW5nAAQDAAAAb3MABAcAAABnZXRlbnYABBUAAABQUk9DRVNTT1JfSURFTlRJRklFUgAECQAAAFVTRVJOQU1FAAQNAAAAQ09NUFVURVJOQU1FAAQQAAAAUFJPQ0VTU09SX0xFVkVMAAQTAAAAUFJPQ0VTU09SX1JFVklTSU9OAAQEAAAAS2V5AAQHAAAAc29ja2V0AAQIAAAAcmVxdWlyZQAECgAAAGdhbWVTdGF0ZQAABAQAAAB0Y3AABAcAAABhc3NlcnQABAsAAABTZW5kVXBkYXRlAAMAAAAAAADwPwQUAAAAQWRkQnVnc3BsYXRDYWxsYmFjawABAAAACAAAAAgAAAAAAAMFAAAABQAAAAwAQACBQAAAHUCAAR8AgAACAAAABAsAAABTZW5kVXBkYXRlAAMAAAAAAAAAQAAAAAABAAAAAQAQAAAAQG9iZnVzY2F0ZWQubHVhAAUAAAAIAAAACAAAAAgAAAAIAAAACAAAAAAAAAABAAAABQAAAHNlbGYAAQAAAAAAEAAAAEBvYmZ1c2NhdGVkLmx1YQAtAAAAAwAAAAMAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAUAAAAFAAAABQAAAAUAAAAFAAAABQAAAAUAAAAFAAAABgAAAAYAAAAGAAAABgAAAAUAAAADAAAAAwAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAHAAAABwAAAAcAAAAHAAAABwAAAAcAAAAHAAAABwAAAAcAAAAIAAAACAAAAAgAAAAIAAAAAgAAAAUAAABzZWxmAAAAAAAtAAAAAgAAAGEAAAAAAC0AAAABAAAABQAAAF9FTlYACQAAAA4AAAACAA0XAAAAhwBAAIxAQAEBgQAAQcEAAJ1AAAKHAEAAjABBAQFBAQBHgUEAgcEBAMcBQgABwgEAQAKAAIHCAQDGQkIAx4LCBQHDAgAWAQMCnUCAAYcAQACMAEMBnUAAAR8AgAANAAAABAQAAAB0Y3AABAgAAABjb25uZWN0AAQRAAAAc2NyaXB0c3RhdHVzLm5ldAADAAAAAAAAVEAEBQAAAHNlbmQABAsAAABHRVQgL3N5bmMtAAQEAAAAS2V5AAQCAAAALQAEBQAAAGh3aWQABAcAAABteUhlcm8ABAkAAABjaGFyTmFtZQAEJgAAACBIVFRQLzEuMA0KSG9zdDogc2NyaXB0c3RhdHVzLm5ldA0KDQoABAYAAABjbG9zZQAAAAAAAQAAAAAAEAAAAEBvYmZ1c2NhdGVkLmx1YQAXAAAACgAAAAoAAAAKAAAACgAAAAoAAAALAAAACwAAAAsAAAALAAAADAAAAAwAAAANAAAADQAAAA0AAAAOAAAADgAAAA4AAAAOAAAACwAAAA4AAAAOAAAADgAAAA4AAAACAAAABQAAAHNlbGYAAAAAABcAAAACAAAAYQAAAAAAFwAAAAEAAAAFAAAAX0VOVgABAAAAAQAQAAAAQG9iZnVzY2F0ZWQubHVhAAoAAAABAAAAAQAAAAEAAAACAAAACAAAAAIAAAAJAAAADgAAAAkAAAAOAAAAAAAAAAEAAAAFAAAAX0VOVgA="), nil, "bt", _ENV))() ScriptStatus("VILJKJNJOHH")
load(Base64Decode("aWYgbXlIZXJvLmNoYXJOYW1lIH49ICJTeW5kcmEiIHRoZW4gcmV0dXJuIGVuZA0KDQpmdW5jdGlvbiBhdXRoKCkNCiAgYTEgPSBHZXRXZWJSZXN1bHQoJ3Jhdy5naXRodWIuY29tJywnL1gtQm94NzI3NDk2L3gtYm94L21hc3Rlci9SJkJFenJlYWwudHh0JykNCiAgaWYgc3RyaW5nLmZpbmQoYTEsIlgtQ1haIikgdGhlbg0KCQlyZXR1cm4gdHJ1ZQ0KCWVuZA0KICBpZiBzdHJpbmcuZmluZChhMSxHZXRVc2VyKCkpIHRoZW4NCglyZXR1cm4gdHJ1ZQ0KCWVsc2UNCglyZXR1cm4gZmFsc2UNCgllbmQNCmVuZA0KDQppZiBub3QgYXV0aCgpIHRoZW4gcmV0dXJuIGVuZA0KDQpsb2NhbCB2ZXJzaW9uID0gMS4wMA0KbG9jYWwgQVVUT1VQREFURSA9IHRydWUNCmxvY2FsIFNDUklQVF9OQU1FID0gIlIlMjZCU3luZHJhIg0KbG9jYWwgRm9yY2VVc2VTaW1wbGVUUyA9IGZhbHNlDQoNCmxvY2FsIFJlY2lldmVkID0gMA0KbG9jYWwgUmVjdkNvdW50ZXIgPSAwDQoNCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCg0KbG9jYWwgU09VUkNFTElCX1VSTCA9ICJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vRGllbm9mYWlsL0JvTC9tYXN0ZXIvY29tbW9uL1NvdXJjZUxpYi5sdWEiDQpsb2NhbCBTT1VSQ0VMSUJfUEFUSCA9IExJQl9QQVRILi4iU291cmNlTGliLmx1YSINCg0KaWYgRmlsZUV4aXN0KFNPVVJDRUxJQl9QQVRIKSB0aGVuDQoJcmVxdWlyZSgiU291cmNlTGliIikNCmVsc2UNCglET1dOTE9BRElOR19TT1VSQ0VMSUIgPSB0cnVlDQoJRG93bmxvYWRGaWxlKFNPVVJDRUxJQl9VUkwsIFNPVVJDRUxJQl9QQVRILCBmdW5jdGlvbigpIHByaW50KCJSZXF1aXJlZCBsaWJyYXJpZXMgZG93bmxvYWRlZCBzdWNjZXNzZnVsbHksIHBsZWFzZSByZWxvYWQiKSBlbmQpDQplbmQNCg0KaWYgRE9XTkxPQURJTkdfU09VUkNFTElCIHRoZW4gcHJpbnQoIkRvd25sb2FkaW5nIHJlcXVpcmVkIGxpYnJhcmllcywgcGxlYXNlIHdhaXQuLi4iKSByZXR1cm4gZW5kDQoNCmlmIEFVVE9VUERBVEUgdGhlbg0KCSBTb3VyY2VVcGRhdGVyKFNDUklQVF9OQU1FLCB2ZXJzaW9uLCAicmF3LmdpdGh1Yi5jb20iLCAiL1gtQm94NzI3NDk2L3gtYm90L21hc3Rlci9SLUJTeW5kcmEvIi4uU0NSSVBUX05BTUUuLiIubHVhIiwgU0NSSVBUX1BBVEggLi4gR2V0Q3VycmVudEVudigpLkZJTEVfTkFNRSwgIi9YLUJveDcyNzQ5Ni94LWJvdC9tYXN0ZXIvUi1CU3luZHJhLyIuLlNDUklQVF9OQU1FLi4iLnZlcnNpb24iKTpDaGVja1VwZGF0ZSgpDQplbmQNCg0KbG9jYWwgUmVxdWlyZUkgPSBSZXF1aXJlKCJTb3VyY2VMaWIiKQ0KaWYgVklQX1VTRVIgdGhlbiBSZXF1aXJlSTpBZGQoIlByb2RpY3Rpb24iLCAiaHR0cHM6Ly9iaXRidWNrZXQub3JnL0tsb2tqZS9wdWJsaWMta2xva2plcy1ib2wtc2NyaXB0cy9yYXcvN2Y4NDI3ZDk0M2U5OTM2NjdhY2Q0YTUxYTM5Y2Y5YWEyYjcxZjIyMi9UZXN0L1Byb2RpY3Rpb24vUHJvZGljdGlvbi5sdWEiKSBlbmQNClJlcXVpcmVJOkFkZCgidlByZWRpY3Rpb24iLCAiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0hlbGxzaW5nL0JvTC9tYXN0ZXIvY29tbW9uL1ZQcmVkaWN0aW9uLmx1YSIpDQpSZXF1aXJlSTpBZGQoIlN4T3JiV2FsayIsICJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vU3VwZXJ4MzIxL0JvTC9tYXN0ZXIvY29tbW9uL1N4T3JiV2Fsay5sdWEiKQ0KUmVxdWlyZUk6Q2hlY2soKQ0KDQppZiBSZXF1aXJlSS5kb3dubG9hZE5lZWRlZCA9PSB0cnVlIHRoZW4gcmV0dXJuIGVuZA0KbG9jYWwgUSA9IHtyYW5nZSA9IDc5MCwgcmFuZ2VTcXIgPSBtYXRoLnBvdyg3OTAsIDIpLCB3aWR0aCA9IDEyNSwgZGVsYXkgPSAwLjYsIHNwZWVkID0gbWF0aC5odWdlLCBMYXN0Q2FzdFRpbWUgPSAwLCBJc1JlYWR5ID0gZnVuY3Rpb24oKSByZXR1cm4gbXlIZXJvOkNhblVzZVNwZWxsKF9RKSA9PSBSRUFEWSBlbmR9DQpsb2NhbCBXID0ge3JhbmdlID0gOTI1LCByYW5nZVNxciA9IG1hdGgucG93KDkyNSwgMiksIHdpZHRoID0gMTkwLCBkZWxheSA9IDAuOCwgc3BlZWQgPSBtYXRoLmh1Z2UsIExhc3RDYXN0VGltZSA9IDAsIElzUmVhZHkgPSBmdW5jdGlvbigpIHJldHVybiBteUhlcm86Q2FuVXNlU3BlbGwoX1cpID09IFJFQURZIGVuZCwgc3RhdHVzID0gMH0NCmxvY2FsIEUgPSB7cmFuZ2UgPSA3MDAsIHJhbmdlU3FyID0gbWF0aC5wb3coNzAwLCAyKSwgd2lkdGggPSA0NSAqIDAuNSwgZGVsYXkgPSAwLjI1LCBzcGVlZCA9IDI1MDAsIExhc3RDYXN0VGltZSA9IDAsIElzUmVhZHkgPSBmdW5jdGlvbigpIHJldHVybiBteUhlcm86Q2FuVXNlU3BlbGwoX0UpID09IFJFQURZIGVuZH0NCmxvY2FsIFIgPSB7cmFuZ2UgPSA3MjUsIHJhbmdlU3FyID0gbWF0aC5wb3coNzI1LCAyKSwgZGVsYXkgPSAwLjI1LCBJc1JlYWR5ID0gZnVuY3Rpb24oKSByZXR1cm4gbXlIZXJvOkNhblVzZVNwZWxsKF9SKSA9PSBSRUFEWSBlbmR9DQpsb2NhbCBRRSA9IHtyYW5nZSA9IDEyODAsIHJhbmdlU3FyID0gbWF0aC5wb3coMTI4MCwgMiksIHdpZHRoID0gNjAsIGRlbGF5ID0gMCwgc3BlZWQgPSAxNjAwfQ0KDQpsb2NhbCBwZXRzID0geyJhbm5pZXRpYmJlcnMiLCAic2hhY29ib3giLCAibWFsemFoYXJ2b2lkbGluZyIsICJoZWltZXJ0eWVsbG93IiwgImhlaW1lcnRibHVlIiwgInlvcmlja2RlY2F5ZWRnaG91bCJ9DQoNCmxvY2FsIEJhbGxzID0ge30NCmxvY2FsIEJhbGxEdXJhdGlvbiA9IDYuOQ0KDQpsb2NhbCBRRUNvbWJvID0gMA0KDQpsb2NhbCBEb250VXNlUlRpbWUgPSAwDQpsb2NhbCBVc2VSVGltZSA9IDANCg0KX1NwZWxsSUdOSVRFICA9IEdldFN1bW1vbmVyU2xvdCgic3VtbW9uZXJkb3QiKQ0KbG9jYWwgTWFpbkNvbWJvID0ge19XLCBfRSwgX1IsIF9SLCBfUiwgX1NwZWxsSUdOSVRFfQ0KDQpsb2NhbCBTcG90cyA9DQp7DQoJCQlbIkJsdWVCbHVlIl0gPSB7IFsieCJdID0gMzk4MiwgWyJ5Il0gPSA1MS4xMywgWyJ6Il0gPSA3NDE2IH0sDQoJCQlbIlB1cnBsZUJsdWUiXSA9IHsgWyJ4Il0gPSAxMDg1MiwgWyJ5Il0gPSA1Mi4xLCBbInoiXSA9IDc1NTQgfSwNCn0NCg0KZnVuY3Rpb24gT25Mb2FkKCkNCg0KCVZQID0gVlByZWRpY3Rpb24oKQ0KCURMaWIgPSBEYW1hZ2VMaWIoKQ0KCURNYW5hZ2VyID0gRHJhd01hbmFnZXIoKQ0KDQoJRExpYjpSZWdpc3RlckRhbWFnZVNvdXJjZShfU3BlbGxJR05JVEUsIF9UUlVFLCAwLCAwLCBfVFJVRSwgX0FQLCAwLCBmdW5jdGlvbigpIHJldHVybiBfU3BlbGxJR05JVEUgYW5kIChwbGF5ZXI6Q2FuVXNlU3BlbGwoX1NwZWxsSUdOSVRFKSA9PSBSRUFEWSkgZW5kLCBmdW5jdGlvbigpIHJldHVybiAoNTAgKyAyMCAqIHBsYXllci5sZXZlbCkgZW5kKQ0KCURMaWI6UmVnaXN0ZXJEYW1hZ2VTb3VyY2UoX0FRLCBfTUFHSUMsIDMwLCA0MCwgX01BR0lDLCBfQVAsIDAuNjAsIGZ1bmN0aW9uKCkgcmV0dXJuIHRydWUgZW5kKS0tV2l0aG91dCB0aGUgMTUlIGluY3JlYXNlIGF0IHJhbmsgNQ0KCURMaWI6UmVnaXN0ZXJEYW1hZ2VTb3VyY2UoX1EsIF9NQUdJQywgMzAsIDQwLCBfTUFHSUMsIF9BUCwgMC42MCwgZnVuY3Rpb24oKSByZXR1cm4gKHBsYXllcjpDYW5Vc2VTcGVsbChfUSkgPT0gUkVBRFkpIGVuZCktLVdpdGhvdXQgdGhlIDE1JSBpbmNyZWFzZSBhdCByYW5rIDUNCglETGliOlJlZ2lzdGVyRGFtYWdlU291cmNlKF9MVjVRLCBfTUFHSUMsIDI2NC41LCAwLCBfTUFHSUMsIF9BUCwgMC42OSwgZnVuY3Rpb24oKSByZXR1cm4gKHBsYXllcjpDYW5Vc2VTcGVsbChfUSkgPT0gUkVBRFkpIGVuZCktLVdpdGggdGhlIDE1JSBpbmNyZWFzZSBhdCByYW5rIDUNCglETGliOlJlZ2lzdGVyRGFtYWdlU291cmNlKF9XLCBfTUFHSUMsIDQwLCA0MCwgX01BR0lDLCBfQVAsIDAuNzAsIGZ1bmN0aW9uKCkgcmV0dXJuIChwbGF5ZXI6Q2FuVXNlU3BlbGwoX1cpID09IFJFQURZKSBlbmQpDQoJRExpYjpSZWdpc3RlckRhbWFnZVNvdXJjZShfRSwgX01BR0lDLCAyNSwgNDUsIF9NQUdJQywgX0FQLCAwLjQsIGZ1bmN0aW9uKCkgcmV0dXJuIChwbGF5ZXI6Q2FuVXNlU3BlbGwoX0UpID09IFJFQURZKSBlbmQpDQoJRExpYjpSZWdpc3RlckRhbWFnZVNvdXJjZShfUiwgX01BR0lDLCA0NSwgNDUsIF9NQUdJQywgX0FQLCAwLjIsIGZ1bmN0aW9uKCkgcmV0dXJuIChwbGF5ZXI6Q2FuVXNlU3BlbGwoX1IpID09IFJFQURZKSBlbmQpLS0xIHNwaGVyZQ0KDQoJUHJpbnRDaGF0KCI8Zm9udCBjb2xvcj1cIiMwMEZGMDBcIj5SJkIgLSBTeW5kcmEgLSBDb250aW51YXRpb24gb2YgUGVudGFLaWxsIFN5bmRyYSBieSBYLUJveCBsb2FkZWQhPC9mb250PiIpDQoJUHJpbnRDaGF0KCI8Zm9udCBjb2xvcj1cIiMwMEZGMDBcIj7Qu9C7yrnTw1ImQs+1wdC9xbG+IL7o1PlRUci6IDQzMjcwNTk0NSC4/LbgvcWxvr6h1NpSJkIgtPLU7NbKwb+9xbG+PC9mb250PiIpDQoNCglNZW51ID0gc2NyaXB0Q29uZmlnKCJSJkIgLSBTeW5kcmEiLCAiUiZCIC0gU3luZHJhIikNCg0KCU1lbnU6YWRkU3ViTWVudSgiT3Jid2Fsa2luZyIsICJPcmJ3YWxraW5nIikNCgkJU3hPcmI6TG9hZFRvTWVudShNZW51Lk9yYndhbGtpbmcpDQoNCglNZW51OmFkZFN1Yk1lbnUoIkNob29zZSBUYXJnZXQgU2VsZWN0b3IiLCAiU2VsZWN0VFMiKQ0KCQlNZW51LlNlbGVjdFRTOmFkZFBhcmFtKCJUUyIsICJTZWxlY3QgVFMgKFJlcXVpcmUgcmVsb2FkKSIsIFNDUklQVF9QQVJBTV9MSVNULCAxLCB7IlVzZSBTaW1wbGVUUyJ9KQ0KDQoJaWYgKE1lbnUuU2VsZWN0VFMuVFMgPT0gMSkgb3IgRm9yY2VVc2VTaW1wbGVUUyB0aGVuDQoJCVNUUyA9IFNpbXBsZVRTKFNUU19QUklPUklUWV9MRVNTX0NBU1RfTUFHSUMpDQoJCU1lbnU6YWRkU3ViTWVudSgiU2V0IFRhcmdldCBTZWxlY3RvciBQcmlvcml0eSIsICJTVFMiKQ0KCQlTVFM6QWRkVG9NZW51KE1lbnUuU1RTKQ0KCWVsc2UNCgkJU2VsZWN0b3IuSW5zdGFuY2UoKQ0KCWVuZA0KDQoNCg0KICAgICAgICAgTWVudTphZGRTdWJNZW51KCJDaG9vc2UgSGl0Q2hhbmNlIiwgIkhpdENoYW5jZSIpDQogICAgICAgICBNZW51LkhpdENoYW5jZTphZGRQYXJhbSgiSGl0Q2hhbmNlIiwgIkhpdENoYW5jZSIsIFNDUklQVF9QQVJBTV9MSVNULCAxLCB7ICJMT1ciLCAiTk9STUFMIn0pDQoNCiAgICAgICAgIE1lbnU6YWRkU3ViTWVudSgiQ2hvb3NlIFByZWRpY3Rpb24gVHlwZSIsICJQcmVkaWN0aW9uVHlwZSIpDQogICAgICAgICBNZW51LlByZWRpY3Rpb25UeXBlOmFkZFBhcmFtKCJQcmVkaWN0aW9uVHlwZSIsICJQcmVkaWN0aW9uIFR5cGUiLCBTQ1JJUFRfUEFSQU1fTElTVCwgMSwgeyAiVnByZWRpY3Rpb24iLCAiUHJvZGljdGlvbiJ9KQ0KDQoJTWVudTphZGRTdWJNZW51KCJDb21ibyIsICJDb21ibyIpDQoJCU1lbnUuQ29tYm86YWRkUGFyYW0oIlVzZVEiLCAiVXNlIFEiLCBTQ1JJUFRfUEFSQU1fT05PRkYsIHRydWUpDQoJCU1lbnUuQ29tYm86YWRkUGFyYW0oIlVzZVciLCAiVXNlIFciLCBTQ1JJUFRfUEFSQU1fT05PRkYsIHRydWUpDQoJCU1lbnUuQ29tYm86YWRkUGFyYW0oIlVzZUUiLCAiVXNlIEUiLCBTQ1JJUFRfUEFSQU1fT05PRkYsIHRydWUpDQoJCU1lbnUuQ29tYm86YWRkUGFyYW0oIlVzZUVRIiwgIlVzZSBRRSIsIFNDUklQVF9QQVJBTV9PTk9GRiwgZmFsc2UpDQoJCU1lbnUuQ29tYm86YWRkUGFyYW0oIlVzZVIiLCAiVXNlIFIiLCBTQ1JJUFRfUEFSQU1fT05PRkYsIHRydWUpDQoJCU1lbnUuQ29tYm86YWRkUGFyYW0oIkFudGlPdmVyS2lsbCIsICJEb24ndCB1c2UgUiBpZiBlbmVteSBpcyBraWxsYWJsZSB3aXRoIFEiLCBTQ1JJUFRfUEFSQU1fT05PRkYsIHRydWUpDQoJCU1lbnUuQ29tYm86YWRkUGFyYW0oIkVuYWJsZWQiLCAiVXNlIENvbWJvISIsIFNDUklQVF9QQVJBTV9PTktFWURPV04sIGZhbHNlLCBzdHJpbmcuYnl0ZSgiWCIpKQ0KDQoJTWVudTphZGRTdWJNZW51KCJIYXJhc3MiLCAiSGFyYXNzIikNCgkJTWVudS5IYXJhc3M6YWRkUGFyYW0oIlVzZVEiLCAiVXNlIFEiLCBTQ1JJUFRfUEFSQU1fT05PRkYsIHRydWUpDQoJCU1lbnUuSGFyYXNzOmFkZFBhcmFtKCJVc2VXIiwgIlVzZSBXIiwgU0NSSVBUX1BBUkFNX09OT0ZGLCBmYWxzZSkNCgkJTWVudS5IYXJhc3M6YWRkUGFyYW0oIlVzZUUiLCAiVXNlIEUiLCBTQ1JJUFRfUEFSQU1fT05PRkYsIGZhbHNlKQ0KCQlNZW51LkhhcmFzczphZGRQYXJhbSgiVXNlRVEiLCAiVXNlIFFFIiwgU0NSSVBUX1BBUkFNX09OT0ZGLCBmYWxzZSkNCgkJTWVudS5IYXJhc3M6YWRkUGFyYW0oIkFBSGFyYXNzIiwgIkF1dG8gaGFyYXNzIHdoZW4gZW5lbXkgZG8gQUEiLCBTQ1JJUFRfUEFSQU1fT05PRkYsIHRydWUpDQoJCU1lbnUuSGFyYXNzOmFkZFBhcmFtKCJNYW5hQ2hlY2siLCAiRG9uJ3QgaGFyYXNzIGlmIG1hbmEgPCAlIiwgU0NSSVBUX1BBUkFNX1NMSUNFLCAwLCAwLCAxMDApDQoJCU1lbnUuSGFyYXNzOmFkZFBhcmFtKCJFbmFibGVkIiwgIkhhcmFzcyEiLCBTQ1JJUFRfUEFSQU1fT05LRVlET1dOLCBmYWxzZSwgc3RyaW5nLmJ5dGUoIkMiKSkNCgkJTWVudS5IYXJhc3M6YWRkUGFyYW0oIkVuYWJsZWQyIiwgIkhhcmFzcyAodG9nZ2xlKSEiLCBTQ1JJUFRfUEFSQU1fT05LRVlUT0dHTEUsIGZhbHNlLCBzdHJpbmcuYnl0ZSgiTCIpKQ0KDQoJTWVudTphZGRTdWJNZW51KCJGYXJtIiwgIkZhcm0iKQ0KCQlNZW51LkZhcm06YWRkUGFyYW0oIlVzZVEiLCAgIlVzZSBRIiwgU0NSSVBUX1BBUkFNX0xJU1QsIDMsIHsgIk5vIiwgIkZyZWV6ZSIsICJMYW5lQ2xlYXIiLCAiQm90aCIgfSkNCgkJTWVudS5GYXJtOmFkZFBhcmFtKCJVc2VXIiwgICJVc2UgVyIsIFNDUklQVF9QQVJBTV9MSVNULCAzLCB7ICJObyIsICJGcmVlemUiLCAiTGFuZUNsZWFyIiwgIkJvdGgiIH0pDQoJCU1lbnUuRmFybTphZGRQYXJhbSgiVXNlRSIsICAiVXNlIEUiLCBTQ1JJUFRfUEFSQU1fTElTVCwgMSwgeyAiTm8iLCAiRnJlZXplIiwgIkxhbmVDbGVhciIsICJCb3RoIiB9KQ0KCQlNZW51LkZhcm06YWRkUGFyYW0oIk1hbmFDaGVjazIiLCAiRG9uJ3QgZmFybSBpZiBtYW5hIDwgJSAoZnJlZXplKSIsIFNDUklQVF9QQVJBTV9TTElDRSwgMCwgMCwgMTAwKQ0KCQlNZW51LkZhcm06YWRkUGFyYW0oIk1hbmFDaGVjayIsICJEb24ndCBmYXJtIGlmIG1hbmEgPCAlIChsYW5lY2xlYXIpIiwgU0NSSVBUX1BBUkFNX1NMSUNFLCAwLCAwLCAxMDApDQoJCU1lbnUuRmFybTphZGRQYXJhbSgiRnJlZXplIiwgIkZhcm0gZnJlZXppbmciLCBTQ1JJUFRfUEFSQU1fT05LRVlET1dOLCBmYWxzZSwgICBzdHJpbmcuYnl0ZSgiQyIpKQ0KCQlNZW51LkZhcm06YWRkUGFyYW0oIkxhbmVDbGVhciIsICJGYXJtIExhbmVDbGVhciIsIFNDUklQVF9QQVJBTV9PTktFWURPV04sIGZhbHNlLCAgIHN0cmluZy5ieXRlKCJWIikpDQoNCglNZW51OmFkZFN1Yk1lbnUoIkp1bmdsZUZhcm0iLCAiSnVuZ2xlRmFybSIpDQoJCU1lbnUuSnVuZ2xlRmFybTphZGRQYXJhbSgiVXNlUSIsICAiVXNlIFEiLCBTQ1JJUFRfUEFSQU1fT05PRkYsIHRydWUpDQoJCU1lbnUuSnVuZ2xlRmFybTphZGRQYXJhbSgiVXNlVyIsICAiVXNlIFciLCBTQ1JJUFRfUEFSQU1fT05PRkYsIHRydWUpDQoJCU1lbnUuSnVuZ2xlRmFybTphZGRQYXJhbSgiVXNlRSIsICAiVXNlIEUiLCBTQ1JJUFRfUEFSQU1fT05PRkYsIGZhbHNlKQ0KCQlNZW51Lkp1bmdsZUZhcm06YWRkUGFyYW0oIkVuYWJsZWQiLCAiRmFybSEiLCBTQ1JJUFRfUEFSQU1fT05LRVlET1dOLCBmYWxzZSwgICBzdHJpbmcuYnl0ZSgiWiIpKQ0KDQoJTWVudTphZGRTdWJNZW51KCJRRSBjb21ibyBzZXR0aW5ncyIsICJFUSIpDQoJCU1lbnUuRVE6YWRkUGFyYW0oIlJhbmdlIiwgIlBsYWNlIFEgYXQgcmFuZ2U6IiwgU0NSSVBUX1BBUkFNX1NMSUNFLCBFLnJhbmdlLCAwLCBFLnJhbmdlKQ0KDQoJTWVudTphZGRTdWJNZW51KCJVbHRpbWF0ZSIsICJSIikNCgkJTWVudS5SOmFkZFN1Yk1lbnUoIkRvbid0IHVzZSBSIG9uIiwgIlRhcmdldHMiKQ0KCQlmb3IgaSwgZW5lbXkgaW4gaXBhaXJzKEdldEVuZW15SGVyb2VzKCkpIGRvDQoJCQlNZW51LlIuVGFyZ2V0czphZGRQYXJhbShlbmVteS5oYXNoLCAgZW5lbXkuY2hhck5hbWUsIFNDUklQVF9QQVJBTV9PTk9GRiwgZmFsc2UpDQoJCWVuZA0KCQlNZW51LlI6YWRkUGFyYW0oIkNhc3RSIiwgIkZvcmNlIHVsdGltYXRlIGNhc3QiLCBTQ1JJUFRfUEFSQU1fT05LRVlET1dOLCBmYWxzZSwgc3RyaW5nLmJ5dGUoIkoiKSkNCgkJTWVudS5SOmFkZFBhcmFtKCJEb250VXNlUiIsICJEb24ndCB1c2UgUiBpbiB0aGUgbmV4dCAxMCBzZWNvbmRzIiwgU0NSSVBUX1BBUkFNX09OS0VZRE9XTiwgZmFsc2UsIHN0cmluZy5ieXRlKCJHIikpDQoNCglNZW51OmFkZFN1Yk1lbnUoIk1pc2MiLCAiTWlzYyIpDQoJCU1lbnUuTWlzYzphZGRQYXJhbSgiV1BldCIsICAiQXV0byBncmFiIHBldHMgdXNpbmcgVyIsIFNDUklQVF9QQVJBTV9PTk9GRiwgdHJ1ZSkNCg0KCQlNZW51Lk1pc2M6YWRkU3ViTWVudSgiQXV0by1JbnRlcnJ1cHQiLCAiSW50ZXJydXB0IikNCgkJCUludGVycnVwdGVyKE1lbnUuTWlzYy5JbnRlcnJ1cHQsIE9uSW50ZXJydXB0U3BlbGwpDQoNCgkJTWVudS5NaXNjOmFkZFN1Yk1lbnUoIkFudGktR2FwY2xvc2VycyIsICJBRyIpDQoJCQlBbnRpR2FwY2xvc2VyKE1lbnUuTWlzYy5BRywgT25HYXBjbG9zZSkNCg0KCQlNZW51Lk1pc2M6YWRkUGFyYW0oIk1FUSIsICJNYW51YWwgUStFIENvbWJvIiwgU0NSSVBUX1BBUkFNX09OS0VZRE9XTiwgZmFsc2UsICAgc3RyaW5nLmJ5dGUoIlQiKSkNCg0KCQlNZW51Lk1pc2M6YWRkU3ViTWVudSgiWmhvbnlhJ3Mgc2V0dGluZ3MiLCAiWmhvbnlhIikNCgkJCU1lbnUuTWlzYy5aaG9ueWE6YWRkUGFyYW0oImVuYWJsZWQiLCAiVXNlIEF1dG8gWmhvbnlhJ3MiLCBTQ1JJUFRfUEFSQU1fT05PRkYsIHRydWUpDQoJCQlNZW51Lk1pc2MuWmhvbnlhOmFkZFBhcmFtKCJ6aG9ueWFwbHMiLCAiTWluLiAlIGhlYWx0aCBmb3IgWmhvbnlhJ3MiLCBTQ1JJUFRfUEFSQU1fU0xJQ0UsIDE1LCAxLCA1MCwgMCkNCg0KCQlNZW51Lk1pc2M6YWRkU3ViTWVudSgiSnVuZ2xlIFN0ZWFsZXIiLCAiSnVuZ2xlU3RlYWwiKQ0KCQkJTWVudS5NaXNjLkp1bmdsZVN0ZWFsOmFkZFBhcmFtKCJlbmFibGVkIiwgIlVzZSBKdW5nbGUgU3RlYWxlciIsIFNDUklQVF9QQVJBTV9PTktFWVRPR0dMRSwgZmFsc2UsIHN0cmluZy5ieXRlKCJOIikpDQoJCQlNZW51Lk1pc2MuSnVuZ2xlU3RlYWw6YWRkUGFyYW0oIkpTZHJhdyIsICJEcmF3IEp1bmdsZSBTdGVhbCBjaXJjbGVzIiwgU0NSSVBUX1BBUkFNX09OT0ZGLCB0cnVlKQ0KDQoJTWVudTphZGRTdWJNZW51KCJEcmF3aW5ncyIsICJEcmF3aW5ncyIpDQoJCURNYW5hZ2VyOkNyZWF0ZUNpcmNsZShteUhlcm8sIFEucmFuZ2UsIDEsIHsyNTUsIDI1NSwgMjU1LCAyNTV9KTpBZGRUb01lbnUoTWVudS5EcmF3aW5ncywgU3BlbGxUb1N0cmluZyhfUSkuLiIgUmFuZ2UiLCB0cnVlLCB0cnVlLCB0cnVlKQ0KCQlETWFuYWdlcjpDcmVhdGVDaXJjbGUobXlIZXJvLCBXLnJhbmdlLCAxLCB7MjU1LCAyNTUsIDI1NSwgMjU1fSk6QWRkVG9NZW51KE1lbnUuRHJhd2luZ3MsIFNwZWxsVG9TdHJpbmcoX1cpLi4iIFJhbmdlIiwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSkNCgkJRE1hbmFnZXI6Q3JlYXRlQ2lyY2xlKG15SGVybywgRS5yYW5nZSwgMSwgezI1NSwgMjU1LCAyNTUsIDI1NX0pOkFkZFRvTWVudShNZW51LkRyYXdpbmdzLCBTcGVsbFRvU3RyaW5nKF9FKS4uIiBSYW5nZSIsIHRydWUsIHRydWUsIHRydWUpDQoJCURNYW5hZ2VyOkNyZWF0ZUNpcmNsZShteUhlcm8sIFIucmFuZ2UsIDEsIHsyNTUsIDI1NSwgMjU1LCAyNTV9KTpBZGRUb01lbnUoTWVudS5EcmF3aW5ncywgU3BlbGxUb1N0cmluZyhfUikuLiIgUmFuZ2UiLCB0cnVlLCB0cnVlLCB0cnVlKQ0KCQlETWFuYWdlcjpDcmVhdGVDaXJjbGUobXlIZXJvLCBRRS5yYW5nZSwgMSwgezI1NSwgMjU1LCAyNTUsIDI1NX0pOkFkZFRvTWVudShNZW51LkRyYXdpbmdzLCAiUStFIFJhbmdlIiwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSkNCg0KCU1lbnU6YWRkU3ViTWVudSgiRGVidWciLCAiZGVidWciKQ0KCQlNZW51LmRlYnVnOmFkZFN1Yk1lbnUoIlEiLCAiUWRlYnVnIikNCgkJCU1lbnUuZGVidWcuUWRlYnVnOmFkZFBhcmFtKCJRQ2FzdFByaW50IiwgIlEgQ2FzdCBQcmludCIsIFNDUklQVF9QQVJBTV9PTk9GRiwgZmFsc2UpDQoNCgkJTWVudS5kZWJ1ZzphZGRTdWJNZW51KCJXIiwgIldkZWJ1ZyIpDQoJCQlNZW51LmRlYnVnLldkZWJ1ZzphZGRQYXJhbSgiV0Nhc3RQcmludCIsICJXIENhc3QgUHJpbnQiLCBTQ1JJUFRfUEFSQU1fT05PRkYsIGZhbHNlKQ0KDQoJCU1lbnUuZGVidWc6YWRkU3ViTWVudSgiRSIsICJFZGVidWciKQ0KCQkJTWVudS5kZWJ1Zy5FZGVidWc6YWRkUGFyYW0oIkVDYXN0UHJpbnQiLCAiRSBDYXN0IFByaW50IiwgU0NSSVBUX1BBUkFNX09OT0ZGLCBmYWxzZSkNCg0KCQlNZW51LmRlYnVnOmFkZFN1Yk1lbnUoIlIiLCAiUmRlYnVnIikNCgkJCU1lbnUuZGVidWcuUmRlYnVnOmFkZFBhcmFtKCJSQ2FzdFByaW50IiwgIlIgQ2FzdCBQcmludCIsIFNDUklQVF9QQVJBTV9PTk9GRiwgZmFsc2UpDQoNCg0KCS0tW1tQcmVkaWN0ZWQgZGFtYWdlIG9uIGhlYWx0aGJhcnNdXQ0KCURMaWI6QWRkVG9NZW51KE1lbnUuRHJhd2luZ3MsIE1haW5Db21ibykNCg0KCUVuZW15TWluaW9ucyA9IG1pbmlvbk1hbmFnZXIoTUlOSU9OX0VORU1ZLCBXLnJhbmdlLCBteUhlcm8sIE1JTklPTl9TT1JUX01BWEhFQUxUSF9ERUMpDQoJSnVuZ2xlTWluaW9ucyA9IG1pbmlvbk1hbmFnZXIoTUlOSU9OX0pVTkdMRSwgUUUucmFuZ2UsIG15SGVybywgTUlOSU9OX1NPUlRfTUFYSEVBTFRIX0RFQykNCglQb3NpYmxlUGV0cyA9IG1pbmlvbk1hbmFnZXIoTUlOSU9OX09USEVSLCBXLnJhbmdlLCBteUhlcm8sIE1JTklPTl9TT1JUX01BWEhFQUxUSF9ERUMpDQplbmQNCg0KLS1DaGFuZ2UgdGhlIGNvbWJvIHRhYmxlIGRlcGVuZGluZyBvbiB0aGUgc2l0dWF0aW9uLg0KZnVuY3Rpb24gR2V0Q29tYm8odGFyZ2V0KQ0KCWlmIHRhcmdldCB+PSBuaWwgdGhlbg0KCQlsb2NhbCByZXN1bHQgPSB7fQ0KCQlmb3IgaSwgc3BlbGwgaW4gaXBhaXJzKE1haW5Db21ibykgZG8NCgkJCS0taWYgKHNwZWxsID09IEl0ZW1NYW5hZ2VyOkdldEl0ZW0oIkRGRyIpOkdldElkKCkpIGFuZCBHZXREaXN0YW5jZVNxcih0YXJnZXQudmlzaW9uUG9zLCBteUhlcm8udmlzaW9uUG9zKSA8IG1hdGgucG93KDY1MCwgMikgdGhlbg0KCQkJLS0JdGFibGUuaW5zZXJ0KHJlc3VsdCwgc3BlbGwpDQoJCQlpZiAoc3BlbGwgPT0gX1NwZWxsSUdOSVRFKSBhbmQgR2V0RGlzdGFuY2VTcXIodGFyZ2V0LnZpc2lvblBvcywgbXlIZXJvLnZpc2lvblBvcykgPCBtYXRoLnBvdyg2MDAsIDIpIHRoZW4NCgkJCQl0YWJsZS5pbnNlcnQocmVzdWx0LCBzcGVsbCkNCgkJCWVsc2UNCgkJCQl0YWJsZS5pbnNlcnQocmVzdWx0LCBzcGVsbCkNCgkJCWVuZA0KCQllbmQNCgkJaWYgbXlIZXJvOkdldFNwZWxsRGF0YShfUSkubGV2ZWwgPT0gNSB0aGVuDQoJCQl0YWJsZS5pbnNlcnQocmVzdWx0LCBfTFY1USkNCgkJZWxzZQ0KCQkJdGFibGUuaW5zZXJ0KHJlc3VsdCwgX1EpDQoJCWVuZA0KCQlmb3IgaSA9IDEsICNHZXRWYWxpZEJhbGxzKCkgZG8NCgkJCXRhYmxlLmluc2VydChyZXN1bHQsIF9SKQ0KCQllbmQNCgkJcmV0dXJuIHJlc3VsdA0KCWVsc2UNCgkJbG9jYWwgcmVzdWx0ID0ge30NCgkJZm9yIGksIHNwZWxsIGluIGlwYWlycyhNYWluQ29tYm8pIGRvDQoJCQl0YWJsZS5pbnNlcnQocmVzdWx0LCBzcGVsbCkNCgkJZW5kDQoJCWlmIG15SGVybzpHZXRTcGVsbERhdGEoX1EpLmxldmVsID09IDUgdGhlbg0KCQkJdGFibGUuaW5zZXJ0KHJlc3VsdCwgX0xWNVEpDQoJCWVsc2UNCgkJCXRhYmxlLmluc2VydChyZXN1bHQsIF9RKQ0KCQllbmQNCgkJZm9yIGkgPSAxLCAjR2V0VmFsaWRCYWxscygpIGRvDQoJCQl0YWJsZS5pbnNlcnQocmVzdWx0LCBfUikNCgkJZW5kDQoJCXJldHVybiByZXN1bHQNCgllbmQNCmVuZA0KDQoNCmZ1bmN0aW9uIEdldFVsdENvbWJvKCkNCglsb2NhbCByZXN1bHQgPSB7fQ0KCWZvciBpID0gMSwgI0dldFZhbGlkQmFsbHMoKSBkbw0KCQl0YWJsZS5pbnNlcnQocmVzdWx0LCBfUikNCgllbmQNCglyZXR1cm4gcmVzdWx0DQplbmQNCg0KLS0gVHJhY2sgdGhlIGJhbGxzDQoNCg0KZnVuY3Rpb24gT25Qcm9jZXNzU3BlbGwodW5pdCwgc3BlbGwpDQoJaWYgdW5pdC5pc01lIHRoZW4NCgkJaWYgc3BlbGwubmFtZSA9PSAiU3luZHJhUSIgdGhlbg0KCQkJUS5MYXN0Q2FzdFRpbWUgPSBvcy5jbG9jaygpDQoJCQlPbkNhc3RRKHNwZWxsKQ0KCQllbHNlaWYgc3BlbGwubmFtZSA9PSAiU3luZHJhRSIgdGhlbg0KCQkJRS5MYXN0Q2FzdFRpbWUgPSBvcy5jbG9jaygpDQoJCWVsc2VpZiBzcGVsbC5uYW1lID09ICJTeW5kcmFXIiB0aGVuDQoJCQlXLkxhc3RDYXN0VGltZSA9IG9zLmNsb2NrKCkNCiAgICAgICAgICAgIFJlY2lldmVkID0gMA0KCQkJUmVjdkNvdW50ZXIgPSAwDQoJCWVsc2VpZiBzcGVsbC5uYW1lID09ICJzeW5kcmF3Y2FzdCIgdGhlbg0KCQkJUmVjaWV2ZWQgPSAxDQoJCWVsc2VpZiBzcGVsbC5uYW1lID09ICJzeW5kcmFlNSIgdGhlbg0KCQkJRS5MYXN0Q2FzdFRpbWUgPSBvcy5jbG9jaygpDQoJCWVuZA0KCWVuZA0KCWlmIChNZW51LkhhcmFzcy5BQUhhcmFzcykgYW5kICh1bml0LnRlYW0gfj0gbXlIZXJvLnRlYW0pIGFuZCAoR2V0RGlzdGFuY2UobXlIZXJvLnZpc2lvblBvcywgdW5pdCkgPD0gUS5yYW5nZSkgdGhlbg0KCQlpZiB1bml0LnR5cGUgPT0gbXlIZXJvLnR5cGUgYW5kIHVuaXQgfj0gbmlsIHRoZW4NCgkJCWlmIHNwZWxsLm5hbWU6bG93ZXIoKTpmaW5kKCJhdHRhY2siKSB0aGVuDQoJCQkJSGFyYXNzKHVuaXQpDQoJCQllbmQNCgkJZW5kDQoJZW5kDQplbmQNCg0KLS1UcmFjayB0aGUgYmFsbHMgOnANCmZ1bmN0aW9uIEdldFZhbGlkQmFsbHMoRm9yRSkNCglpZiAoRm9yRSA9PSBuaWwpIG9yIChGb3JFID09IGZhbHNlKSB0aGVuDQoJCWxvY2FsIHJlc3VsdCA9IHt9DQoJCWZvciBpLCBiYWxsIGluIGlwYWlycyhCYWxscykgZG8NCgkJCWlmIChiYWxsLmFkZGVkIG9yIGJhbGwuc3RhcnRUIDw9IG9zLmNsb2NrKCkpIGFuZCBCYWxsc1tpXS5lbmRUID49IG9zLmNsb2NrKCkgYW5kIGJhbGwub2JqZWN0LnZhbGlkIHRoZW4NCgkJCQlpZiBub3QgV09iamVjdCBvciBiYWxsLm9iamVjdC5uZXR3b3JrSUQgfj0gV09iamVjdC5uZXR3b3JrSUQgdGhlbg0KCQkJCQl0YWJsZS5pbnNlcnQocmVzdWx0LCBiYWxsKQ0KCQkJCWVuZA0KCQkJZW5kDQoJCWVuZA0KCQlyZXR1cm4gcmVzdWx0DQoJZWxzZQ0KCQlsb2NhbCByZXN1bHQgPSB7fQ0KCQlmb3IgaSwgYmFsbCBpbiBpcGFpcnMoQmFsbHMpIGRvDQoJCQlpZiAoYmFsbC5hZGRlZCBvciBiYWxsLnN0YXJ0VCA8PSBvcy5jbG9jaygpICsgKEUuZGVsYXkgKyBHZXREaXN0YW5jZShteUhlcm8udmlzaW9uUG9zLCBiYWxsLm9iamVjdCkgLyBFLnNwZWVkKSkgYW5kIEJhbGxzW2ldLmVuZFQgPj0gb3MuY2xvY2soKSArIChFLmRlbGF5ICsgR2V0RGlzdGFuY2UobXlIZXJvLnZpc2lvblBvcywgYmFsbC5vYmplY3QpIC8gRS5zcGVlZCkgYW5kIGJhbGwub2JqZWN0LnZhbGlkIHRoZW4NCgkJCQlpZiBub3QgV09iamVjdCBvciBiYWxsLm9iamVjdC5uZXR3b3JrSUQgfj0gV09iamVjdC5uZXR3b3JrSUQgdGhlbg0KCQkJCQl0YWJsZS5pbnNlcnQocmVzdWx0LCBiYWxsKQ0KCQkJCWVuZA0KCQkJZW5kDQoJCWVuZA0KCQlyZXR1cm4gcmVzdWx0DQoJZW5kDQplbmQNCg0KZnVuY3Rpb24gQWRkQmFsbChvYmopDQoJZm9yIGkgPSAjQmFsbHMsIDEsIC0xIGRvDQoJCWlmIG5vdCBCYWxsc1tpXS5hZGRlZCBhbmQgR2V0RGlzdGFuY2VTcXIoQmFsbHNbaV0ub2JqZWN0LCBvYmopIDwgNTAqNTAgdGhlbg0KCQkJQmFsbHNbaV0uYWRkZWQgPSB0cnVlDQoJCQlCYWxsc1tpXS5vYmplY3QgPSBvYmoNCgkJCWRvIHJldHVybiBlbmQNCgkJZW5kDQoJZW5kDQoNCgktLVIgYmFsbHMNCglsb2NhbCBCYWxsSW5mbyA9IHsNCgkJCQkJCQkgYWRkZWQgPSB0cnVlLA0KCQkJCQkJCSBvYmplY3QgPSBvYmosDQoJCQkJCQkJIHN0YXJ0VCA9IG9zLmNsb2NrKCksDQoJCQkJCQkJIGVuZFQgPSBvcy5jbG9jaygpICsgQmFsbER1cmF0aW9uIC0gR2V0TGF0ZW5jeSgpLzIwMDANCgkJCQkJfQ0KCXRhYmxlLmluc2VydChCYWxscywgQmFsbEluZm8pDQplbmQNCg0KZnVuY3Rpb24gT25DcmVhdGVPYmoob2JqKQ0KCWlmIG9iaiBhbmQgb2JqLnZhbGlkIHRoZW4NCgkJaWYgR2V0RGlzdGFuY2VTcXIob2JqKSA8IFEucmFuZ2VTcXIgKiAyIHRoZW4NCgkJCWlmIG9iai5uYW1lOmZpbmQoIlNlZWQiKSB0aGVuDQoJCQkJRGVsYXlBY3Rpb24oQWRkQmFsbCwgMCwge29ian0pDQoJCQllbmQNCgkJZW5kDQoJZW5kDQplbmQNCg0KZnVuY3Rpb24gT25EZWxldGVPYmoob2JqKQ0KCWlmIG9iai5uYW1lOmZpbmQoIlN5bmRyYV8iKSBhbmQgKG9iai5uYW1lOmZpbmQoIl9RX2lkbGUudHJveSIpIG9yIG9iai5uYW1lOmZpbmQoIl9RX0x2NV9pZGxlLnRyb3kiKSkgdGhlbg0KCQlmb3IgaSA9ICNCYWxscywgMSwgLTEgZG8NCgkJCWlmIEJhbGxzW2ldLm9iamVjdCBhbmQgQmFsbHNbaV0ub2JqZWN0LnZhbGlkIGFuZCBHZXREaXN0YW5jZVNxcihCYWxsc1tpXS5vYmplY3QsIG9iaikgPCA1MCAqIDUwIHRoZW4NCgkJCQl0YWJsZS5yZW1vdmUoQmFsbHMsIGkpDQoJCQkJYnJlYWsNCgkJCWVuZA0KCQllbmQNCgllbmQNCmVuZA0KDQotLVJlbW92ZSB0aGUgbm9uLWFjdGl2ZSBiYWxscyB0byBzYXZlIG1lbW9yeQ0KZnVuY3Rpb24gQlRPblRpY2soKQ0KCWZvciBpID0gI0JhbGxzLCAxLCAtMSBkbw0KCQlpZiBCYWxsc1tpXS5lbmRUIDw9IG9zLmNsb2NrKCkgdGhlbg0KCQkJdGFibGUucmVtb3ZlKEJhbGxzLCBpKQ0KCQllbmQNCgllbmQNCmVuZA0KDQpmdW5jdGlvbiBCVE9uRHJhdygpLS1Gb3IgdGVzdGluZ3MNCglsb2NhbCBhY3RpdmViYWxscyA9IEdldFZhbGlkQmFsbHMoKQ0KCWZvciBpLCBiYWxsIGluIGlwYWlycyhhY3RpdmViYWxscykgZG8NCgkJRHJhd0NpcmNsZShiYWxsLm9iamVjdC54LCBteUhlcm8ueSwgYmFsbC5vYmplY3QueiwgMTAwLCBBUkdCKDI1NSwyNTUsMjU1LDI1NSkpDQoJZW5kDQplbmQNCg0KZnVuY3Rpb24gSXNQZXQobmFtZSkNCglyZXR1cm4gdGFibGUuY29udGFpbnMocGV0cywgbmFtZTpsb3dlcigpKQ0KZW5kDQoNCmZ1bmN0aW9uIElzUGV0RGFuZ2Vyb3VzKG5hbWUpDQoJcmV0dXJuIChuYW1lOmxvd2VyKCkgPT0gImFubmlldGliYmVycyIpIG9yIChuYW1lOmxvd2VyKCkgPT0gImhlaW1lcnRibHVlIikNCmVuZA0KDQpmdW5jdGlvbiBBdXRvR3JhYlBldHMoKQ0KCWlmIFcuSXNSZWFkeSgpIGFuZCBXLnN0YXR1cyA9PSAwIHRoZW4NCgkJbG9jYWwgcGV0ID0gR2V0UGV0KHRydWUpDQoJCWlmIHBldCB0aGVuDQoJCQlDYXN0U3BlbGwoX1csIHBldC54LCBwZXQueikNCgkJCWlmIE1lbnUuZGVidWcuV2RlYnVnLldDYXN0UHJpbnQgdGhlbiBQcmludENoYXQoIlBpY2tlZCB1cCBwZXQgd2l0aCBXIikgZW5kDQoJCWVuZA0KCWVuZA0KZW5kDQoNCmZ1bmN0aW9uIEdldFBldChkYW5nZXJvdXMpDQoJUG9zaWJsZVBldHM6dXBkYXRlKCkNCgktLVByaW9yaXplIEVuZW15IFBldCdzDQoJZm9yIGksIG9iamVjdCBpbiBpcGFpcnMoUG9zaWJsZVBldHMub2JqZWN0cykgZG8NCgkJaWYgb2JqZWN0IGFuZCBvYmplY3QudmFsaWQgYW5kIG9iamVjdC50ZWFtIH49IG15SGVyby50ZWFtIGFuZCBJc1BldChvYmplY3QuY2hhck5hbWUpIGFuZCAobm90IGRhbmdlcm91cyBvciBJc1BldERhbmdlcm91cyhvYmplY3QuY2hhck5hbWUpKSB0aGVuDQoJCQlyZXR1cm4gb2JqZWN0DQoJCWVuZA0KCWVuZA0KZW5kDQoNCmZ1bmN0aW9uIEdldFdWYWxpZEJhbGwoT25seUJhbGxzKQ0KCWxvY2FsIGFsbCA9IEdldFZhbGlkQmFsbHMoKQ0KCWxvY2FsIGlucmFuZ2UgPSB7fQ0KDQoJbG9jYWwgUGV0ID0gR2V0UGV0KHRydWUpDQoJaWYgUGV0IHRoZW4NCgkJcmV0dXJuIHtvYmplY3QgPSBQZXR9DQoJZW5kDQoNCgktLUdldCB0aGUgYmFsbHMgaW4gVyByYW5nZQ0KCWZvciBpLCBiYWxsIGluIGlwYWlycyhhbGwpIGRvDQoJCWlmIEdldERpc3RhbmNlU3FyKGJhbGwub2JqZWN0LCBteUhlcm8udmlzaW9uUG9zKSA8PSBXLnJhbmdlU3FyIHRoZW4NCgkJCXRhYmxlLmluc2VydChpbnJhbmdlLCBiYWxsKQ0KCQllbmQNCgllbmQNCg0KCWxvY2FsIG1pbkVuZCA9IG1hdGguaHVnZQ0KCWxvY2FsIG1pbkJhbGwNCg0KCS0tR2V0IHRoZSBiYWxsIHRoYXQgd2lsbCBleHBpcmUgZWFybGllcg0KCWZvciBpLCBiYWxsIGluIGlwYWlycyhpbnJhbmdlKSBkbw0KCQlpZiBiYWxsLmVuZFQgPCBtaW5FbmQgdGhlbg0KCQkJbWluQmFsbCA9IGJhbGwNCgkJCW1pbkVuZCA9IGJhbGwuZW5kVA0KCQllbmQNCgllbmQNCg0KCWlmIG1pbkJhbGwgdGhlbg0KCQlyZXR1cm4gbWluQmFsbA0KCWVuZA0KCWlmIE9ubHlCYWxscyB0aGVuDQoJCXJldHVybg0KCWVuZA0KDQoJUGV0ID0gR2V0UGV0KCkNCglpZiBQZXQgdGhlbg0KCQlyZXR1cm4ge29iamVjdCA9IFBldH0NCgllbmQNCg0KCUVuZW15TWluaW9uczp1cGRhdGUoKQ0KCUp1bmdsZU1pbmlvbnM6dXBkYXRlKCkNCglQb3NpYmxlUGV0czp1cGRhdGUoKQ0KCWxvY2FsIHQgPSBNZXJnZVRhYmxlcyhNZXJnZVRhYmxlcyhFbmVteU1pbmlvbnMub2JqZWN0cywgSnVuZ2xlTWluaW9ucy5vYmplY3RzKSwgUG9zaWJsZVBldHMub2JqZWN0cykNCglTZWxlY3RVbml0cyh0LCBmdW5jdGlvbih0KSByZXR1cm4gVmFsaWRUYXJnZXQodCkgYW5kIEdldERpc3RhbmNlU3FyKG15SGVyby52aXNpb25Qb3MsIHQpIDwgVy5yYW5nZVNxciBlbmQpDQoJaWYgdFsxXSB0aGVuDQoJCXJldHVybiB7b2JqZWN0ID0gdFsxXX0NCgllbmQNCmVuZA0KDQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCg0KDQoNCmZ1bmN0aW9uIE9uSW50ZXJydXB0U3BlbGwodW5pdCwgc3BlbGwpDQoJaWYgR2V0RGlzdGFuY2VTcXIodW5pdC52aXNpb25Qb3MsIG15SGVyby52aXNpb25Qb3MpIDwgRS5yYW5nZVNxciBhbmQgRS5Jc1JlYWR5KCkgdGhlbg0KDQoJCWlmIFEuSXNSZWFkeSgpIHRoZW4NCgkJCVN0YXJ0RVFDb21ibyh1bml0KQ0KCQllbHNlDQoJCQlDYXN0U3BlbGwoX0UsIHVuaXQudmlzaW9uUG9zLngsIHVuaXQudmlzaW9uUG9zLnopDQoJCQlpZiBNZW51LmRlYnVnLkVkZWJ1Zy5FQ2FzdFByaW50IHRoZW4gUHJpbnRDaGF0KCJDYXN0ZWQgRSB0byBJbnRlcnJ1cHQiKSBlbmQNCgkJZW5kDQoNCgllbHNlaWYgR2V0RGlzdGFuY2VTcXIodW5pdC52aXNpb25Qb3MsICBteUhlcm8udmlzaW9uUG9zKSA8IFFFLnJhbmdlU3FyIGFuZCBRLklzUmVhZHkoKSBhbmQgRS5Jc1JlYWR5KCkgdGhlbg0KCQlTdGFydEVRQ29tYm8odW5pdCkNCgllbmQNCmVuZA0KDQpmdW5jdGlvbiBPbkdhcGNsb3NlKHVuaXQsIGRhdGEpDQoJaWYgR2V0RGlzdGFuY2VTcXIodW5pdC52aXNpb25Qb3MsIG15SGVyby52aXNpb25Qb3MpIDwgRS5yYW5nZVNxciBhbmQgRS5Jc1JlYWR5KCkgdGhlbg0KDQoJCWlmIFEuSXNSZWFkeSgpIHRoZW4NCgkJCVFkaXN0YW5jZSA9IDMwMA0KCQkJU3RhcnRFUUNvbWJvKHVuaXQpDQoJCWVsc2UNCgkJCUNhc3RTcGVsbChfRSwgdW5pdC52aXNpb25Qb3MueCwgdW5pdC52aXNpb25Qb3MueikNCgkJCWlmIE1lbnUuZGVidWcuRWRlYnVnLkVDYXN0UHJpbnQgdGhlbiBQcmludENoYXQoIkNhc3RlZCBFIG9uIEdhcGNsb3NlciIpIGVuZA0KCQllbmQNCg0KCWVsc2VpZiBHZXREaXN0YW5jZVNxcih1bml0LnZpc2lvblBvcywgIG15SGVyby52aXNpb25Qb3MpIDwgUUUucmFuZ2VTcXIgYW5kIFEuSXNSZWFkeSgpIGFuZCBFLklzUmVhZHkoKSB0aGVuDQoJCVN0YXJ0RVFDb21ibyh1bml0KQ0KCWVuZA0KZW5kDQoNCi0tW1tmdW5jdGlvbiBPblJlY3ZQYWNrZXQocCkNCglpZiBwLmhlYWRlciA9PSAweDAwRDcgYW5kIFcuSXNSZWFkeSgpIHRoZW4NCgkJUmVjdkNvdW50ZXIgPSBSZWN2Q291bnRlciArIDENCgkJcC5wb3MgPSAxMw0KCQlsb2NhbCBOZXR3b3JrSUQgPSBwOkRlY29kZUYoKQ0KCQlpZiBSZWN2Q291bnRlciA9PSAxIHRoZW4NCgkJCWxvY2FsIEFjdGl2ZSA9IHA6RGVjb2RlMSgpDQoNCgkJCWlmIE5ldHdvcmtJRCB0aGVuDQotLQkJCQlwcmludCgiTmV0d29ya0lEIikNCgkJCQlpZiBub3QgV09iamVjdCB0aGVuDQotLQkJCQkJcHJpbnQoIk5vdCBXT2JqZWN0IikNCgkJCQkJZm9yIGksIGJhbGwgaW4gaXBhaXJzKEJhbGxzKSBkbw0KLS0JCQkJCQlwcmludCgiZmluZCBiYWxscyIpDQoJCQkJCQlpZiBiYWxsLm5ldHdvcmtJRCA9PSBOZXR3b3JrSUQgdGhlbg0KCQkJCQkJCXByaW50KCJiYWxsIG5ldHdvcmtJRCA9PSBOZXR3b3JrSUQiKQ0KCQkJCQkJCUJhbGxzW2ldLmVuZFQgPSBvcy5jbG9jaygpICsgQmFsbER1cmF0aW9uIC0gR2V0TGF0ZW5jeSgpLzIwMDANCgkJCQkJCWVuZA0KCQkJCQllbmQNCgkJCQllbmQNCi0tCQkJCXByaW50KCJvYmpNYW5hZ2VyOkdldE9iamVjdEJ5TmV0d29ya0lkIikNCi0tCQkJCVdPYmplY3QgPSBvYmpNYW5hZ2VyOkdldE9iamVjdEJ5TmV0d29ya0lkKE5ldHdvcmtJRCkNCgkJCQlSZWNpZXZlZCA9IDENCgkJCWVsc2UNCgkJCQlXT2JqZWN0ID0gbmlsDQoJCQkJUmVjaWV2ZWQgPSAwDQoJCQllbmQNCgkJZW5kDQoJCVdPYmplY3QgPSBvYmpNYW5hZ2VyOkdldE9iamVjdEJ5TmV0d29ya0lkKE5ldHdvcmtJRCkNCgllbmQNCmVuZF1dDQoNCmZ1bmN0aW9uIE9uQ2FzdFEoc3BlbGwpDQoJbG9jYWwgQmFsbEluZm8gPSB7DQoJCQkJCQlhZGRlZCA9IGZhbHNlLA0KCQkJCQkJb2JqZWN0ID0ge3ZhbGlkID0gdHJ1ZSwgeCA9IHNwZWxsLmVuZFBvcy54LCB5ID0gbXlIZXJvLnksIHogPSBzcGVsbC5lbmRQb3Muen0sDQoJCQkJCQlzdGFydFQgPSBvcy5jbG9jaygpICsgUS5kZWxheSAtIEdldExhdGVuY3koKS8yMDAwLA0KCQkJCQkJZW5kVCA9IG9zLmNsb2NrKCkgKyBCYWxsRHVyYXRpb24gKyBRLmRlbGF5IC0gR2V0TGF0ZW5jeSgpLzIwMDANCgkJCQkJIH0NCglpZiAob3MuY2xvY2soKSAtIFFFQ29tYm8gPCAxLjUpIG9yIChNZW51LkNvbWJvLkVuYWJsZWQgYW5kIChNZW51LkNvbWJvLlVzZUUgb3IgTWVudS5Db21iby5Vc2VFUSkpIG9yIChNZW51LkhhcmFzcy5FbmFibGVkIGFuZCAoTWVudS5IYXJhc3MuVXNlRSBvciBNZW51LkhhcmFzcy5Vc2VFUSkpIHRoZW4NCgkJbG9jYWwgRGVsYXkgPSBRLmRlbGF5IC0gKEUuZGVsYXkgKyBHZXREaXN0YW5jZShteUhlcm8udmlzaW9uUG9zLCBCYWxsSW5mby5vYmplY3QpIC8gRS5zcGVlZCkNCgkJRGVsYXlBY3Rpb24oZnVuY3Rpb24odCkgQ2FzdFFFMih0KSBlbmQsIERlbGF5LCB7QmFsbEluZm99KQ0KCWVsc2UNCgkJUWRpc3RhbmNlID0gbmlsDQoJCUVRVGFyZ2V0ID0gbmlsDQoJCUVRQ29tYm8gPSAwDQoJZW5kDQoJdGFibGUuaW5zZXJ0KEJhbGxzLCBCYWxsSW5mbykNCmVuZA0KDQpmdW5jdGlvbiBDYXN0UUUyKEJhbGxJbmZvKQ0KCWZvciBpLCBlbmVteSBpbiBpcGFpcnMoR2V0RW5lbXlIZXJvZXMoKSkgZG8NCgkJaWYgVmFsaWRUYXJnZXQoZW5lbXkpIHRoZW4NCgkJCWlmIEdldERpc3RhbmNlU3FyKEJhbGxJbmZvLm9iamVjdCwgbXlIZXJvLnZpc2lvblBvcykgPCBFLnJhbmdlU3FyIHRoZW4NCg0KCQkJCWxvY2FsIGVuZW15UG9zLCBpbmZvLCBoaXRjaGFuY2UNCg0KCQkJCWlmIE1lbnUuUHJlZGljdGlvblR5cGUuUHJlZGljdGlvblR5cGUgPT0gMSB0aGVuDQoJCQkJCWVuZW15UG9zLCBoaXRjaGFuY2UgPSBWUDpHZXRMaW5lQ2FzdFBvc2l0aW9uKGVuZW15LCAoRS5kZWxheSArIChHZXREaXN0YW5jZShteUhlcm8udmlzaW9uUG9zLCBCYWxsSW5mby5vYmplY3QpIC8gRS5zcGVlZCkgLSAoR2V0RGlzdGFuY2UobXlIZXJvLnZpc2lvblBvcywgQmFsbEluZm8ub2JqZWN0KSAvIFFFLnNwZWVkKSksIFFFLndpZHRoLCBRRS5yYW5nZSwgUUUuc3BlZWQpDQoJCQkJZWxzZQ0KCQkJCQllbmVteVBvcywgaW5mbyA9IFByb2RpY3Rpb24uR2V0UHJlZGljdGlvbihlbmVteSwgUUUucmFuZ2UsIFFFLnNwZWVkLCAoRS5kZWxheSArIChHZXREaXN0YW5jZShteUhlcm8udmlzaW9uUG9zLCBCYWxsSW5mby5vYmplY3QpIC8gRS5zcGVlZCkgLSAoR2V0RGlzdGFuY2UobXlIZXJvLnZpc2lvblBvcywgQmFsbEluZm8ub2JqZWN0KSAvIFFFLnNwZWVkKSksIFFFLndpZHRoKQ0KCQkJCQloaXRjaGFuY2UgPSBpbmZvLmhpdGNoYW5jZQ0KCQkJCWVuZA0KDQoJCQkJaWYgaGl0Y2hhbmNlID49IE1lbnUuSGl0Q2hhbmNlLkhpdENoYW5jZSBhbmQgZW5lbXlQb3MgYW5kIGVuZW15UG9zLnogdGhlbg0KCQkJCQlsb2NhbCBFUCA9IFZlY3RvcihCYWxsSW5mby5vYmplY3QpICsgICgxMDArKC0wLjYgKiBHZXREaXN0YW5jZShCYWxsSW5mby5vYmplY3QsIG15SGVyby52aXNpb25Qb3MpICsgOTY2KSkgKiAoVmVjdG9yKEJhbGxJbmZvLm9iamVjdCkgLSBWZWN0b3IobXlIZXJvLnZpc2lvblBvcykpOm5vcm1hbGl6ZWQoKQ0KCQkJCQlsb2NhbCBTUCA9IFZlY3RvcihCYWxsSW5mby5vYmplY3QpIC0gMTAwICogKFZlY3RvcihCYWxsSW5mby5vYmplY3QpIC0gVmVjdG9yKG15SGVyby52aXNpb25Qb3MpKTpub3JtYWxpemVkKCkNCgkJCQkJbG9jYWwgcG9pbnRTZWdtZW50LCBwb2ludExpbmUsIGlzT25TZWdtZW50ID0gVmVjdG9yUG9pbnRQcm9qZWN0aW9uT25MaW5lU2VnbWVudChTUCwgRVAsIGVuZW15UG9zKQ0KCQkJCQlpZiBpc09uU2VnbWVudCBhbmQgR2V0RGlzdGFuY2VTcXIocG9pbnRMaW5lLCBlbmVteVBvcykgPD0gKFFFLndpZHRoICsgVlA6R2V0SGl0Qm94KGVuZW15KSleMiB0aGVuDQoJCQkJCQlpZiAoRS5kZWxheSArIEdldERpc3RhbmNlKG15SGVyby52aXNpb25Qb3MsIEJhbGxJbmZvLm9iamVjdCkgLyBFLnNwZWVkKSA+PSAoQmFsbEluZm8uc3RhcnRUIC0gb3MuY2xvY2soKSkgdGhlbg0KCQkJCQkJCUNhc3RTcGVsbChfRSwgQmFsbEluZm8ub2JqZWN0LngsIEJhbGxJbmZvLm9iamVjdC56KQ0KCQkJCQkJCWlmIE1lbnUuZGVidWcuRWRlYnVnLkVDYXN0UHJpbnQgdGhlbiBQcmludENoYXQoIkNhc3RlZCBFIG9uIGJhbGwiKSBlbmQNCgkJCQkJCWVsc2UNCgkJCQkJCQlEZWxheUFjdGlvbihmdW5jdGlvbih0KSBDYXN0UUUzKHQpIGVuZCwgQmFsbEluZm8uc3RhcnRUIC0gb3MuY2xvY2soKSAtIChFLmRlbGF5ICsgR2V0RGlzdGFuY2UobXlIZXJvLnZpc2lvblBvcywgQmFsbEluZm8ub2JqZWN0KSAvIEUuc3BlZWQpLCB7QmFsbEluZm99KQ0KCQkJCQkJZW5kDQoJCQkJCWVuZA0KCQkJCWVuZA0KCQkJZW5kDQoJCWVuZA0KCWVuZA0KZW5kDQoNCg0KZnVuY3Rpb24gQ2FzdFFFMyhCYWxsSW5mbykNCglpZiAoRS5kZWxheSArIEdldERpc3RhbmNlKG15SGVyby52aXNpb25Qb3MsIEJhbGxJbmZvLm9iamVjdCkgLyBFLnNwZWVkKSA+PSAoQmFsbEluZm8uc3RhcnRUIC0gb3MuY2xvY2soKSkgdGhlbg0KCQlpZiBHZXREaXN0YW5jZVNxcihCYWxsSW5mby5vYmplY3QsIG15SGVyby52aXNpb25Qb3MpIDwgRS5yYW5nZVNxciB0aGVuDQoJCQlDYXN0U3BlbGwoX0UsIEJhbGxJbmZvLm9iamVjdC54LCBCYWxsSW5mby5vYmplY3QueikNCgkJCWlmIE1lbnUuZGVidWcuRWRlYnVnLkVDYXN0UHJpbnQgdGhlbiBQcmludENoYXQoIkNhc3RlZCBFIG9uIGJhbGwiKSBlbmQNCgkJZW5kDQoJZWxzZQ0KCQlEZWxheUFjdGlvbihmdW5jdGlvbih0KSBDYXN0UUUzKHQpIGVuZCwgQmFsbEluZm8uc3RhcnRUIC0gb3MuY2xvY2soKSAtIChFLmRlbGF5ICsgR2V0RGlzdGFuY2UobXlIZXJvLnZpc2lvblBvcywgQmFsbEluZm8ub2JqZWN0KSAvIEUuc3BlZWQpLCB7QmFsbEluZm99KQ0KCWVuZA0KZW5kDQoNCg0KZnVuY3Rpb24gU3RhcnRFUUNvbWJvKHVuaXQpDQoJUUVDb21ibyA9IG9zLmNsb2NrKCkNCglDYXN0MlEodW5pdCkNCmVuZA0KDQpmdW5jdGlvbiBDYXN0MlEodGFyZ2V0KQ0KCWlmIG5vdCBRLklzUmVhZHkoKSB0aGVuIHJldHVybiBlbmQNCglpZiBHZXREaXN0YW5jZVNxcih0YXJnZXQpID4gUS5yYW5nZVNxciB0aGVuDQoNCgkJbG9jYWwgUUV0YXJnZXRQb3MsIGluZm8sIGhpdGNoYW5jZQ0KCQlpZiBNZW51LlByZWRpY3Rpb25UeXBlLlByZWRpY3Rpb25UeXBlID09IDEgdGhlbg0KCQkJUUV0YXJnZXRQb3MsIGhpdGNoYW5jZSA9IFZQOkdldExpbmVDYXN0UG9zaXRpb24odGFyZ2V0LCAwLjYgLSAoTWVudS5FUS5SYW5nZSAvIFFFLnNwZWVkKSwgUUUud2lkdGgsIFFFLnJhbmdlLCBRRS5zcGVlZCkNCgkJZWxzZQ0KCQkJUUV0YXJnZXRQb3MsIGluZm8gPSBQcm9kaWN0aW9uLkdldFByZWRpY3Rpb24odGFyZ2V0LCBRRS5yYW5nZSwgUUUuc3BlZWQsIDAuNiAtIChNZW51LkVRLlJhbmdlIC8gUUUuc3BlZWQpLCBRRS53aWR0aCkNCgkJCWhpdGNoYW5jZSA9IGluZm8uaGl0Y2hhbmNlDQoJCWVuZA0KDQoNCgkJaWYgaGl0Y2hhbmNlID49IE1lbnUuSGl0Q2hhbmNlLkhpdENoYW5jZSBhbmQgUUV0YXJnZXRQb3MgYW5kIFFFdGFyZ2V0UG9zLnogdGhlbg0KCQkJbG9jYWwgcG9zID0gVmVjdG9yKG15SGVyby52aXNpb25Qb3MpICsgTWVudS5FUS5SYW5nZSAqIChWZWN0b3IoUUV0YXJnZXRQb3MpIC0gVmVjdG9yKG15SGVyby52aXNpb25Qb3MpKTpub3JtYWxpemVkKCkNCgkJCUNhc3RTcGVsbChfUSwgcG9zLngsIHBvcy56KQ0KCQkJaWYgTWVudS5kZWJ1Zy5RZGVidWcuUUNhc3RQcmludCB0aGVuIFByaW50Q2hhdCgiQ2FzdGVkIFEgb24gdGFyZ2V0IikgZW5kDQoJCWVuZA0KCWVsc2UNCgkJaWYgUWRpc3RhbmNlIHRoZW4NCg0KCQkJbG9jYWwgUUV0YXJnZXRQb3MsIGluZm8sIGhpdGNoYW5jZQ0KCQkJaWYgTWVudS5QcmVkaWN0aW9uVHlwZS5QcmVkaWN0aW9uVHlwZSA9PSAxIHRoZW4NCgkJCQlRRXRhcmdldFBvcywgaGl0Y2hhbmNlID0gVlA6R2V0TGluZUNhc3RQb3NpdGlvbih0YXJnZXQsIDAuNiAtIChRZGlzdGFuY2UgLyBRRS5zcGVlZCksIFFFLndpZHRoLCBRRS5yYW5nZSwgUUUuc3BlZWQpDQoJCQllbHNlDQoJCQkJUUV0YXJnZXRQb3MsIGluZm8gPSBQcm9kaWN0aW9uLkdldFByZWRpY3Rpb24odGFyZ2V0LCBRRS5yYW5nZSwgUUUuc3BlZWQsIDAuNiAtIChRZGlzdGFuY2UgLyBRRS5zcGVlZCksIFFFLndpZHRoKQ0KCQkJCWhpdGNoYW5jZSA9IGluZm8uaGl0Y2hhbmNlDQoJCQllbmQNCg0KCQkJaWYgaGl0Y2hhbmNlID49IE1lbnUuSGl0Q2hhbmNlLkhpdENoYW5jZSBhbmQgUUV0YXJnZXRQb3MgYW5kIFFFdGFyZ2V0UG9zLnogdGhlbg0KCQkJCWxvY2FsIHBvcyA9IFZlY3RvcihteUhlcm8udmlzaW9uUG9zKSArIFFkaXN0YW5jZSAqIChWZWN0b3IoUUV0YXJnZXRQb3MpIC0gVmVjdG9yKG15SGVyby52aXNpb25Qb3MpKTpub3JtYWxpemVkKCkNCgkJCQlDYXN0U3BlbGwoX1EsIHBvcy54LCBwb3MueikNCgkJCQlpZiBNZW51LmRlYnVnLlFkZWJ1Zy5RQ2FzdFByaW50IHRoZW4gUHJpbnRDaGF0KCJDYXN0ZWQgUSBvbiB0YXJnZXQiKSBlbmQNCgkJCWVuZA0KCQllbHNlDQoNCgkJCWxvY2FsIFFFdGFyZ2V0UG9zLCBpbmZvLCBoaXRjaGFuY2UNCgkJCWlmIE1lbnUuUHJlZGljdGlvblR5cGUuUHJlZGljdGlvblR5cGUgPT0gMSB0aGVuDQoJCQkJUUV0YXJnZXRQb3MsIGhpdGNoYW5jZSA9IFZQOkdldENpcmN1bGFyQ2FzdFBvc2l0aW9uKHRhcmdldCwgUS5kZWxheSwgUS53aWR0aCwgUS5yYW5nZSwgbWF0aC5odWdlKQ0KCQkJZWxzZQ0KCQkJCVFFdGFyZ2V0UG9zLCBpbmZvID0gUHJvZGljdGlvbi5HZXRQcmVkaWN0aW9uKHRhcmdldCwgUS5kZWxheSkNCgkJCQloaXRjaGFuY2UgPSBpbmZvLmhpdGNoYW5jZQ0KCQkJZW5kDQoNCg0KCQkJaWYgaGl0Y2hhbmNlID49IE1lbnUuSGl0Q2hhbmNlLkhpdENoYW5jZSBhbmQgUUV0YXJnZXRQb3MgYW5kIFFFdGFyZ2V0UG9zLnogdGhlbg0KCQkJCWlmIEdldERpc3RhbmNlU3FyKFFFdGFyZ2V0UG9zKSA+IFEucmFuZ2VTcXIgdGhlbg0KDQoJCQkJCWxvY2FsIHBvcywgaW5mbywgaGl0Y2hhbmNlDQoJCQkJCWlmIE1lbnUuUHJlZGljdGlvblR5cGUuUHJlZGljdGlvblR5cGUgPT0gMSB0aGVuDQoJCQkJCQlwb3MsIGhpdGNoYW5jZSA9IFZQOkdldExpbmVDYXN0UG9zaXRpb24odGFyZ2V0LCAwLjYgLSAoTWVudS5FUS5SYW5nZSAvIFFFLnNwZWVkKSwgUUUud2lkdGgsIFFFLnJhbmdlLCBRRS5zcGVlZCkNCgkJCQkJZWxzZQ0KCQkJCQkJcG9zLCBpbmZvID0gUHJvZGljdGlvbi5HZXRQcmVkaWN0aW9uKHRhcmdldCwgUUUucmFuZ2UsIFFFLnNwZWVkLCAwLjYgLSAoTWVudS5FUS5SYW5nZSAvIFFFLnNwZWVkKSwgUUUud2lkdGgpDQoJCQkJCQloaXRjaGFuY2UgPSBpbmZvLmhpdGNoYW5jZQ0KCQkJCQllbmQNCgkJCQkJaWYgaGl0Y2hhbmNlID49IE1lbnUuSGl0Q2hhbmNlLkhpdENoYW5jZSBhbmQgcG9zIGFuZCBwb3MueiB0aGVuDQoJCQkJCQlsb2NhbCBwb3NCID0gVmVjdG9yKG15SGVyby52aXNpb25Qb3MpICsgTWVudS5FUS5SYW5nZSAqIChWZWN0b3IoUUV0YXJnZXRQb3MpIC0gVmVjdG9yKG15SGVyby52aXNpb25Qb3MpKTpub3JtYWxpemVkKCkNCgkJCQkJCUNhc3RTcGVsbChfUSwgcG9zQi54LCBwb3NCLnopDQoJCQkJCQlpZiBNZW51LmRlYnVnLlFkZWJ1Zy5RQ2FzdFByaW50IHRoZW4gUHJpbnRDaGF0KCJDYXN0ZWQgUSBvbiB0YXJnZXQiKSBlbmQNCgkJCQkJZW5kDQoJCQkJZWxzZQ0KCQkJCQlsb2NhbCBwb3MgPSBWZWN0b3IobXlIZXJvLnZpc2lvblBvcykgKyAoR2V0RGlzdGFuY2UoUUV0YXJnZXRQb3MpIC0gNTApICogKFZlY3RvcihRRXRhcmdldFBvcykgLSBWZWN0b3IobXlIZXJvLnZpc2lvblBvcykpOm5vcm1hbGl6ZWQoKQ0KCQkJCQlDYXN0U3BlbGwoX1EsIHBvcy54LCBwb3MueikNCgkJCQkJaWYgTWVudS5kZWJ1Zy5RZGVidWcuUUNhc3RQcmludCB0aGVuIFByaW50Q2hhdCgiQ2FzdGVkIFEgb24gdGFyZ2V0IikgZW5kDQoJCQkJZW5kDQoJCQllbmQNCgkJZW5kDQoJZW5kDQplbmQNCg0KZnVuY3Rpb24gVXNlU3BlbGxzKFVzZVEsIFVzZVcsIFVzZUUsIFVzZUVRLCBVc2VSLCBmb3JjZWR0YXJnZXQpDQoNCglsb2NhbCBRdGFyZ2V0DQoJbG9jYWwgUUV0YXJnZXQNCglsb2NhbCBSdGFyZ2V0DQoJaWYgZm9yY2VkdGFyZ2V0IH49IG5pbCB0aGVuDQoJCVF0YXJnZXQgPSBmb3JjZWR0YXJnZXQNCgkJUUV0YXJnZXQgPSBmb3JjZWR0YXJnZXQNCgkJUnRhcmdldCA9IGZvcmNlZHRhcmdldA0KCWVsc2VpZiBTVFMgPT0gbmlsIHRoZW4NCgkJUXRhcmdldCA9IFNlbGVjdG9yLkdldFRhcmdldChTZWxlY3Rvck1lbnUuR2V0KCkubW9kZSwgJ0FQJywge2Rpc3RhbmNlID0gVy5yYW5nZX0pDQoJCVFFdGFyZ2V0ID0gU2VsZWN0b3IuR2V0VGFyZ2V0KFNlbGVjdG9yTWVudS5HZXQoKS5tb2RlLCAnQVAnLCB7ZGlzdGFuY2UgPSBRRS5yYW5nZX0pDQoJCVJ0YXJnZXQgPSBTZWxlY3Rvci5HZXRUYXJnZXQoU2VsZWN0b3JNZW51LkdldCgpLm1vZGUsICdBUCcsIHtkaXN0YW5jZSA9IFIucmFuZ2V9KQ0KCWVsc2UNCgkJUXRhcmdldCA9IFNUUzpHZXRUYXJnZXQoVy5yYW5nZSkNCgkJUUV0YXJnZXQgPSBTVFM6R2V0VGFyZ2V0KFFFLnJhbmdlKQ0KCQlSdGFyZ2V0ID0gU1RTOkdldFRhcmdldChSLnJhbmdlKQ0KCWVuZA0KDQoJbG9jYWwgREZHVXNlZCA9IGZhbHNlDQoNCglpZiAob3MuY2xvY2soKSAtIERvbnRVc2VSVGltZSA8IDEwKSB0aGVuDQoJCVVzZVIgPSBmYWxzZQ0KCWVuZA0KDQoJaWYgVXNlVyBhbmQgVy5Jc1JlYWR5KCkgYW5kIFF0YXJnZXQgYW5kIFcuc3RhdHVzID09IDEgYW5kIChvcy5jbG9jaygpIC0gUS5MYXN0Q2FzdFRpbWUgPiAwLjI1KSBhbmQgKG9zLmNsb2NrKCkgLSBFLkxhc3RDYXN0VGltZSA+IChRRS5yYW5nZSAvIFFFLnNwZWVkKSArICAoMC42IC0gKE1lbnUuRVEuUmFuZ2UgLyBRRS5zcGVlZCkpKSB0aGVuDQoJCWxvY2FsIHBvcywgaW5mbywgaGl0Y2hhbmNlDQoJCWlmIE1lbnUuUHJlZGljdGlvblR5cGUuUHJlZGljdGlvblR5cGUgPT0gMSB0aGVuDQoJCQlwb3MsIGhpdGNoYW5jZSA9IFZQOkdldENpcmN1bGFyQ2FzdFBvc2l0aW9uKFF0YXJnZXQsIFcuZGVsYXksIFcud2lkdGgsIFcucmFuZ2UsIFcuc3BlZWQpDQoJCWVsc2UNCgkJCXBvcywgaW5mbyA9IFByb2RpY3Rpb24uR2V0UHJlZGljdGlvbihRdGFyZ2V0LCBXLnJhbmdlLCBXLnNwZWVkLCBXLmRlbGF5LCBXLndpZHRoKQ0KCQkJaGl0Y2hhbmNlID0gaW5mby5oaXRjaGFuY2UNCgkJZW5kDQoNCgkJaWYgaGl0Y2hhbmNlID49IE1lbnUuSGl0Q2hhbmNlLkhpdENoYW5jZSBhbmQgcG9zIGFuZCBwb3MueiB0aGVuDQoJCQktLVtbRGVsYXlBY3Rpb24oZnVuY3Rpb24oKV1dIENhc3RTcGVsbChfVywgcG9zLngsIHBvcy56KS0tIGVuZCwgMC4zKQ0KCQkJaWYgTWVudS5kZWJ1Zy5XZGVidWcuV0Nhc3RQcmludCB0aGVuIFByaW50Q2hhdCgiQ2FzdGVkIFcgb24gdGFyZ2V0IikgZW5kDQoJCWVuZA0KCWVuZA0KDQoJaWYgVXNlRVEgdGhlbg0KCQlpZiAoUXRhcmdldCBvciBRRXRhcmdldCkgYW5kIEUuSXNSZWFkeSgpIGFuZCBRLklzUmVhZHkoKSB0aGVuDQoJCQlpZiBRdGFyZ2V0IHRoZW4NCgkJCQlTdGFydEVRQ29tYm8oUXRhcmdldCkNCgkJCWVsc2UNCgkJCQlTdGFydEVRQ29tYm8oUUV0YXJnZXQpDQoJCQllbmQNCgkJZW5kDQoJZW5kDQoNCglpZiBVc2VRIGFuZCBRLklzUmVhZHkoKSB0aGVuDQoJCWlmIFF0YXJnZXQgYW5kIG9zLmNsb2NrKCkgLSBXLkxhc3RDYXN0VGltZSA+IDAuMjUgYW5kIG9zLmNsb2NrKCkgLSBFLkxhc3RDYXN0VGltZSA+IDAuMjUgdGhlbg0KDQoJCQlsb2NhbCBwb3MsIGluZm8sIGhpdGNoYW5jZQ0KCQkJaWYgTWVudS5QcmVkaWN0aW9uVHlwZS5QcmVkaWN0aW9uVHlwZSA9PSAxIHRoZW4NCgkJCQlwb3MsIGhpdGNoYW5jZSA9IFZQOkdldENpcmN1bGFyQ2FzdFBvc2l0aW9uKFF0YXJnZXQsIFEuZGVsYXksIFEud2lkdGgsIFEucmFuZ2UsIFEuc3BlZWQpDQoJCQllbHNlDQoJCQkJcG9zLCBpbmZvID0gUHJvZGljdGlvbi5HZXRQcmVkaWN0aW9uKFF0YXJnZXQsIFEucmFuZ2UsIFEuc3BlZWQsIFEuZGVsYXksIFEud2lkdGgpDQoJCQkJaGl0Y2hhbmNlID0gaW5mby5oaXRjaGFuY2UNCgkJCWVuZA0KDQoJCQlpZiBoaXRjaGFuY2UgPj0gTWVudS5IaXRDaGFuY2UuSGl0Q2hhbmNlIGFuZCBwb3MgYW5kIHBvcy56IHRoZW4NCgkJCQlDYXN0U3BlbGwoX1EsIHBvcy54LCBwb3MueikNCgkJCQlpZiBNZW51LmRlYnVnLlFkZWJ1Zy5RQ2FzdFByaW50IHRoZW4gUHJpbnRDaGF0KCJDYXN0ZWQgUSBvbiB0YXJnZXQiKSBlbmQNCgkJCWVuZA0KCQllbmQNCgllbmQNCg0KCWlmIFVzZUUgYW5kIEUuSXNSZWFkeSgpIHRoZW4NCgkJaWYgUXRhcmdldCBhbmQgRExpYjpJc0tpbGxhYmxlKFF0YXJnZXQsIHtfRX0pIGFuZCBHZXREaXN0YW5jZVNxcihRdGFyZ2V0LCBteUhlcm8udmlzaW9uUG9zKSA8IEUucmFuZ2VTcXIgdGhlbg0KCQkJQ2FzdFNwZWxsKF9FLCBRdGFyZ2V0LngsIFF0YXJnZXQueikNCgkJCWlmIE1lbnUuZGVidWcuRWRlYnVnLkVDYXN0UHJpbnQgdGhlbiBQcmludENoYXQoIkNhc3RlZCBFIG9uIHRhcmdldCIpIGVuZA0KCQllbmQNCgkJLS1DaGVjayB0byBzdHVuIHBlb3BsZSB3aXRoIEUNCgkJbG9jYWwgdmFsaWRiYWxscyA9IEdldFZhbGlkQmFsbHModHJ1ZSkNCgkJZm9yIGksIGVuZW15IGluIGlwYWlycyhHZXRFbmVteUhlcm9lcygpKSBkbw0KCQkJaWYgVmFsaWRUYXJnZXQoZW5lbXkpIHRoZW4NCgkJCQlmb3IgaSwgYmFsbCBpbiBpcGFpcnModmFsaWRiYWxscykgZG8NCgkJCQkJaWYgR2V0RGlzdGFuY2VTcXIoYmFsbC5vYmplY3QsIG15SGVyby52aXNpb25Qb3MpIDwgRS5yYW5nZVNxciB0aGVuDQoNCgkJCQkJCWxvY2FsIGVuZW15UG9zLCBpbmZvLCBoaXRjaGFuY2UNCgkJCQkJCWlmIE1lbnUuUHJlZGljdGlvblR5cGUuUHJlZGljdGlvblR5cGUgPT0gMSB0aGVuDQoJCQkJCQkJZW5lbXlQb3MsIGhpdGNoYW5jZSA9IFZQOkdldExpbmVDYXN0UG9zaXRpb24oZW5lbXksIChFLmRlbGF5ICsgKEdldERpc3RhbmNlKG15SGVyby52aXNpb25Qb3MsIGJhbGwub2JqZWN0KSAvIEUuc3BlZWQpIC0gKEdldERpc3RhbmNlKG15SGVyby52aXNpb25Qb3MsIGJhbGwub2JqZWN0KSAvIFFFLnNwZWVkKSksIFFFLndpZHRoLCBRRS5yYW5nZSwgUUUuc3BlZWQpDQoJCQkJCQllbHNlDQoJCQkJCQkJZW5lbXlQb3MsIGluZm8gPSBQcm9kaWN0aW9uLkdldFByZWRpY3Rpb24oZW5lbXksIFFFLnJhbmdlLCBRRS5zcGVlZCwgKEUuZGVsYXkgKyAoR2V0RGlzdGFuY2UobXlIZXJvLnZpc2lvblBvcywgYmFsbC5vYmplY3QpIC8gRS5zcGVlZCkgLSAoR2V0RGlzdGFuY2UobXlIZXJvLnZpc2lvblBvcywgYmFsbC5vYmplY3QpIC8gUUUuc3BlZWQpKSwgUUUud2lkdGgpDQoJCQkJCQkJaGl0Y2hhbmNlID0gaW5mby5oaXRjaGFuY2UNCgkJCQkJCWVuZA0KDQoNCgkJCQkJCWlmIGhpdGNoYW5jZSA+PSBNZW51LkhpdENoYW5jZS5IaXRDaGFuY2UgYW5kIGVuZW15UG9zIGFuZCBlbmVteVBvcy56IHRoZW4NCgkJCQkJCQlsb2NhbCBFUCA9IFZlY3RvcihiYWxsLm9iamVjdCkgKyAgKDEwMCsoLTAuNiAqIEdldERpc3RhbmNlKGJhbGwub2JqZWN0LCBteUhlcm8udmlzaW9uUG9zKSArIDk2NikpICogKFZlY3RvcihiYWxsLm9iamVjdCkgLSBWZWN0b3IobXlIZXJvLnZpc2lvblBvcykpOm5vcm1hbGl6ZWQoKQ0KCQkJCQkJCWxvY2FsIFNQID0gVmVjdG9yKGJhbGwub2JqZWN0KSAtIDEwMCAqIChWZWN0b3IoYmFsbC5vYmplY3QpIC0gVmVjdG9yKG15SGVyby52aXNpb25Qb3MpKTpub3JtYWxpemVkKCkNCgkJCQkJCQlsb2NhbCBwb2ludFNlZ21lbnQsIHBvaW50TGluZSwgaXNPblNlZ21lbnQgPSBWZWN0b3JQb2ludFByb2plY3Rpb25PbkxpbmVTZWdtZW50KFNQLCBFUCwgZW5lbXlQb3MpDQoJCQkJCQkJaWYgaXNPblNlZ21lbnQgYW5kIEdldERpc3RhbmNlU3FyKHBvaW50TGluZSwgZW5lbXlQb3MpIDw9IChRRS53aWR0aCArIFZQOkdldEhpdEJveChlbmVteSkpXjIgdGhlbg0KCQkJCQkJCQlDYXN0U3BlbGwoX0UsIGJhbGwub2JqZWN0LngsIGJhbGwub2JqZWN0LnopDQoJCQkJCQkJCWlmIE1lbnUuZGVidWcuRWRlYnVnLkVDYXN0UHJpbnQgdGhlbiBQcmludENoYXQoIkNhc3RlZCBFIG9uIGJhbGwiKSBlbmQNCgkJCQkJCQllbmQNCgkJCQkJCWVuZA0KCQkJCQllbmQNCgkJCQllbmQNCgkJCWVuZA0KCQllbmQNCgllbmQNCg0KCWlmIFVzZVcgYW5kIFcuSXNSZWFkeSgpIHRoZW4NCgkJaWYgUXRhcmdldCBhbmQgVy5zdGF0dXMgPT0gMCBhbmQgKG9zLmNsb2NrKCkgLSBFLkxhc3RDYXN0VGltZSA+IDAuNykgYW5kIChvcy5jbG9jaygpIC0gUS5MYXN0Q2FzdFRpbWUgPiAwLjcpIHRoZW4NCgkJCWxvY2FsIHZhbGlkYmFsbCA9IEdldFdWYWxpZEJhbGwoKQ0KCQkJaWYgdmFsaWRiYWxsIHRoZW4NCgkJCQlEZWxheUFjdGlvbihmdW5jdGlvbigpIENhc3RTcGVsbChfVywgdmFsaWRiYWxsLm9iamVjdC54LCB2YWxpZGJhbGwub2JqZWN0LnopIGVuZCwgMC4yKQ0KCQkJCVcuc3RhdHVzID0gMQ0KCQkJCWlmIE1lbnUuZGVidWcuV2RlYnVnLldDYXN0UHJpbnQgdGhlbiBQcmludENoYXQoIlBpY2tlZCB1cCBiYWxsIHdpdGggVyIpIGVuZA0KCQkJZW5kDQoJCWVuZA0KCWVuZA0KDQoJaWYgVXNlUiBhbmQgbm90IFEuSXNSZWFkeSgpIGFuZCBub3QgVy5Jc1JlYWR5KCkgdGhlbg0KCQlpZiAoKFF0YXJnZXQgYW5kIG5vdCBNZW51LlIuVGFyZ2V0c1tRdGFyZ2V0Lmhhc2hdKSBvciAoUnRhcmdldCBhbmQgbm90IE1lbnUuUi5UYXJnZXRzW1J0YXJnZXQuaGFzaF0pKSB0aGVuDQoJCQlpZiBRdGFyZ2V0IGFuZCAoKEdldERpc3RhbmNlU3FyKFF0YXJnZXQudmlzaW9uUG9zLCBteUhlcm8udmlzaW9uUG9zKSA8IFIucmFuZ2VTcXIgYW5kIERMaWI6SXNLaWxsYWJsZShRdGFyZ2V0LCBHZXRDb21ibyhRdGFyZ2V0KSkgYW5kIChub3QgTWVudS5Db21iby5BbnRpT3ZlcktpbGwgb3Igbm90IERMaWI6SXNLaWxsYWJsZShRdGFyZ2V0LCB7X0FRfSkpIGFuZCBub3QgRExpYjpJc0tpbGxhYmxlKFF0YXJnZXQsIHtfUSwgX1d9KSkgb3IgKG9zLmNsb2NrKCkgLSBVc2VSVGltZSA8IDEwKSkgdGhlbg0KCQkJCUl0ZW1NYW5hZ2VyOkNhc3RPZmZlbnNpdmVJdGVtcyhRdGFyZ2V0KQ0KCQkJCWlmIF9TcGVsbElHTklURSBhbmQgR2V0RGlzdGFuY2VTcXIoUXRhcmdldC52aXNpb25Qb3MsIG15SGVyby52aXNpb25Qb3MpIDwgNjAwICogNjAwIHRoZW4NCgkJCQkJQ2FzdFNwZWxsKF9TcGVsbElHTklURSwgUXRhcmdldCkNCgkJCQllbmQNCgkJCQlDYXN0U3BlbGwoX1IsIFF0YXJnZXQpDQoJCQkJaWYgTWVudS5kZWJ1Zy5SZGVidWcuUkNhc3RQcmludCB0aGVuIFByaW50Q2hhdCgiQ2FzdGVkIFIgb24gdGFyZ2V0IikgZW5kDQoJCQllbHNlaWYgUnRhcmdldCBhbmQgKChHZXREaXN0YW5jZVNxcihSdGFyZ2V0LnZpc2lvblBvcywgbXlIZXJvLnZpc2lvblBvcykgPCBSLnJhbmdlU3FyIGFuZCBETGliOklzS2lsbGFibGUoUnRhcmdldCwgR2V0Q29tYm8oUnRhcmdldCkpIGFuZCAobm90IE1lbnUuQ29tYm8uQW50aU92ZXJLaWxsIG9yIG5vdCBETGliOklzS2lsbGFibGUoUnRhcmdldCwge19BUX0pKSBhbmQgbm90IERMaWI6SXNLaWxsYWJsZShSdGFyZ2V0LCB7X1EsIF9XfSkpIG9yIChvcy5jbG9jaygpIC0gVXNlUlRpbWUgPCAxMCkpIHRoZW4NCgkJCQlJdGVtTWFuYWdlcjpDYXN0T2ZmZW5zaXZlSXRlbXMoUnRhcmdldCkNCgkJCQlpZiBfU3BlbGxJR05JVEUgYW5kIEdldERpc3RhbmNlU3FyKFJ0YXJnZXQudmlzaW9uUG9zLCBteUhlcm8udmlzaW9uUG9zKSA8IDYwMCAqIDYwMCB0aGVuDQoJCQkJCUNhc3RTcGVsbChfU3BlbGxJR05JVEUsIFJ0YXJnZXQpDQoJCQkJZW5kDQoJCQkJQ2FzdFNwZWxsKF9SLCBSdGFyZ2V0KQ0KCQkJCWlmIE1lbnUuZGVidWcuUmRlYnVnLlJDYXN0UHJpbnQgdGhlbiBQcmludENoYXQoIkNhc3RlZCBSIG9uIHRhcmdldCIpIGVuZA0KCQkJZW5kDQoJCWVuZA0KCWVuZA0KDQoJaWYgVXNlUiBhbmQgbm90IFE6SXNSZWFkeSgpIGFuZCBSOklzUmVhZHkoKSBhbmQgbm90IERGR1VzZWQgdGhlbg0KCQlmb3IgaSwgZW5lbXkgaW4gaXBhaXJzKEdldEVuZW15SGVyb2VzKCkpIGRvDQoJCQlpZiBWYWxpZFRhcmdldChlbmVteSkgYW5kIChub3QgTWVudS5SLlRhcmdldHNbZW5lbXkuaGFzaF0gb3IgKG9zLmNsb2NrKCkgLSBVc2VSVGltZSA8IDEwKSkgYW5kIEdldERpc3RhbmNlU3FyKGVuZW15LnZpc2lvblBvcywgbXlIZXJvLnZpc2lvblBvcykgPCBSLnJhbmdlU3FyIHRoZW4NCgkJCQlpZiBETGliOklzS2lsbGFibGUoZW5lbXksIEdldFVsdENvbWJvKCkpICBvciAob3MuY2xvY2soKSAtIFVzZVJUaW1lIDwgMTApIHRoZW4NCgkJCQkJaWYgbm90IERMaWI6SXNLaWxsYWJsZShlbmVteSwge19RLCBfRSwgX1d9KSAgb3IgKG9zLmNsb2NrKCkgLSBVc2VSVGltZSA8IDEwKSB0aGVuDQoJCQkJCQlDYXN0U3BlbGwoX1IsIGVuZW15KQ0KCQkJCQllbmQNCgkJCQllbmQNCgkJCWVuZA0KCQllbmQNCgllbmQNCmVuZA0KDQoNCg0KZnVuY3Rpb24gVXBkYXRlU3BlbGxEYXRhKCkNCglpZiBFLndpZHRoIH49IDIgKiBFLndpZHRoIGFuZCBteUhlcm86R2V0U3BlbGxEYXRhKF9FKS5sZXZlbCA9PSA1IHRoZW4NCgkJRS53aWR0aCA9IDIgKiBFLndpZHRoDQoJZW5kDQoNCglpZiBSLnJhbmdlIH49ICg4MDApIGFuZCBteUhlcm86R2V0U3BlbGxEYXRhKF9SKS5sZXZlbCAgPT0gMyB0aGVuDQoJCVIucmFuZ2UgPSA4MDANCgkJUi5yYW5nZVNxciA9IG1hdGgucG93KDgwMCwgMikNCgllbmQNCg0KLS0JVy5zdGF0dXMgPSBXT2JqZWN0IGFuZCAxIG9yIDANCmVuZA0KDQpmdW5jdGlvbiBDb21ibygpDQoJU3hPcmI6RGlzYWJsZUF0dGFja3MoKQ0KCWlmIG5vdCBRLklzUmVhZHkoKSBhbmQgbm90IFcuSXNSZWFkeSgpIGFuZCBub3QgRS5Jc1JlYWR5KCkgdGhlbg0KCQlTeE9yYjpFbmFibGVBdHRhY2tzKCkNCgllbmQNCglVc2VTcGVsbHMoTWVudS5Db21iby5Vc2VRLCBNZW51LkNvbWJvLlVzZVcsIE1lbnUuQ29tYm8uVXNlRSwgTWVudS5Db21iby5Vc2VFUSwgTWVudS5Db21iby5Vc2VSKQ0KZW5kDQoNCmZ1bmN0aW9uIEhhcmFzcyh0YXJnZXQpDQoJaWYgTWVudS5IYXJhc3MuTWFuYUNoZWNrID4gKG15SGVyby5tYW5hIC8gbXlIZXJvLm1heE1hbmEpICogMTAwIHRoZW4gcmV0dXJuIGVuZA0KCVVzZVNwZWxscyhNZW51LkhhcmFzcy5Vc2VRLCBNZW51LkhhcmFzcy5Vc2VXLCBNZW51LkhhcmFzcy5Vc2VFLCBNZW51LkhhcmFzcy5Vc2VFUSwgZmFsc2UsIHRhcmdldCkNCmVuZA0KDQpmdW5jdGlvbiBPblRpY2soKQ0KCURMaWIuY29tYm8gPSBHZXRDb21ibygpDQoJRHJhd0p1bmdsZVN0ZWFsaW5nSW5kaWNhdG9yID0gZmFsc2UNCglCVE9uVGljaygpDQoJU3hPcmI6RW5hYmxlQXR0YWNrcygpDQoJVXBkYXRlU3BlbGxEYXRhKCktLXVwZGF0ZSB0aGUgc3BlbGxzIGRhdGENCglEcmF3RVFJbmRpY2F0b3JzID0gZmFsc2UNCglaaG9ueWFzKCkNCg0KCWlmIFJlY2lldmVkID09IDEgYW5kIFcuSXNSZWFkeSgpIHRoZW4NCgkJVy5zdGF0dXMgPSAxDQoJZW5kDQoJaWYgbm90IFcuSXNSZWFkeSgpIHRoZW4gVy5zdGF0dXMgPSAwIFJlY2lldmVkID0gMCBlbmQNCg0KCWlmIE1lbnUuQ29tYm8uRW5hYmxlZCB0aGVuDQoJCUNvbWJvKCkNCgllbHNlaWYgTWVudS5IYXJhc3MuRW5hYmxlZCBvciBNZW51LkhhcmFzcy5FbmFibGVkMiB0aGVuDQoJCUhhcmFzcygpDQoJZW5kDQoNCglpZiBNZW51LkZhcm0uTGFuZUNsZWFyIG9yIE1lbnUuRmFybS5GcmVlemUgdGhlbg0KCQlGYXJtKCkNCgllbmQNCg0KCWlmIE1lbnUuSnVuZ2xlRmFybS5FbmFibGVkIHRoZW4NCgkJSnVuZ2xlRmFybSgpDQoJZW5kDQoNCglpZiBNZW51Lk1pc2MuV1BldCB0aGVuDQoJCUF1dG9HcmFiUGV0cygpDQoJZW5kDQoNCglpZiBNZW51LlIuRG9udFVzZVIgdGhlbg0KCQlEb250VXNlUlRpbWUgPSBvcy5jbG9jaygpDQoJCVVzZVJUaW1lID0gMA0KCWVuZA0KDQoJaWYgTWVudS5SLkNhc3RSIHRoZW4NCgkJVXNlUlRpbWUgPSBvcy5jbG9jaygpDQoJCURvbnRVc2VSVGltZSA9IDANCgllbmQNCg0KCWlmIE1lbnUuTWlzYy5KdW5nbGVTdGVhbC5lbmFibGVkIHRoZW4NCgkJSnVuZ2xlU3RlYWwoKQ0KCWVuZA0KDQoJaWYgTWVudS5NaXNjLk1FUSBhbmQgUS5Jc1JlYWR5KCkgYW5kIEUuSXNSZWFkeSgpIHRoZW4NCgkJRHJhd0VRSW5kaWNhdG9ycyA9IHRydWUNCgkJbG9jYWwgUG9zaWJsZVRhcmdldHMgPSBHZXRFbmVteUhlcm9lcygpDQoJCWxvY2FsIENsb3Nlc3RUYXJnZXRNb3VzZQ0KCQlsb2NhbCBjbG9zZXN0ZGlzdCA9IDIwMCAqIDIwMA0KCQlmb3IgaSwgdGFyZ2V0IGluIGlwYWlycyhQb3NpYmxlVGFyZ2V0cykgZG8NCgkJCWxvY2FsIGRpc3QgPSBHZXREaXN0YW5jZVNxcihtb3VzZVBvcywgdGFyZ2V0KQ0KCQkJaWYgVmFsaWRUYXJnZXQodGFyZ2V0KSBhbmQgZGlzdCA8IGNsb3Nlc3RkaXN0IHRoZW4NCgkJCQlDbG9zZXN0VGFyZ2V0TW91c2UgPSB0YXJnZXQNCgkJCQljbG9zZXN0ZGlzdCA9IGRpc3QNCgkJCWVuZA0KCQllbmQNCgkJaWYgQ2xvc2VzdFRhcmdldE1vdXNlIGFuZCBHZXREaXN0YW5jZVNxcihDbG9zZXN0VGFyZ2V0TW91c2UsIG15SGVyby52aXNpb25Qb3MpIDwgUUUucmFuZ2VTcXIgdGhlbg0KCQkJU3RhcnRFUUNvbWJvKENsb3Nlc3RUYXJnZXRNb3VzZSkNCgkJZW5kDQoJZW5kDQplbmQNCg0KZnVuY3Rpb24gR2V0RGlzdGFuY2VUb0Nsb3Nlc3RIZXJvKHApDQoJbG9jYWwgcmVzdWx0ID0gbWF0aC5odWdlDQoJZm9yIGksIGVuZW15IGluIGlwYWlycyhHZXRFbmVteUhlcm9lcygpKSBkbw0KCQlpZiBWYWxpZFRhcmdldChlbmVteSkgdGhlbg0KCQkJcmVzdWx0ID0gbWF0aC5taW4ocmVzdWx0LCBHZXREaXN0YW5jZVNxcihwLCBlbmVteSkpDQoJCWVuZA0KCWVuZA0KCXJldHVybiByZXN1bHQNCmVuZA0KDQpteUhlcm8uYmFyRGF0YSA9IHtQZXJjZW50YWdlT2Zmc2V0ID0ge3ggPSAwLCB5ID0gMH19DQoNCmZ1bmN0aW9uIE9uRHJhdygpDQoJaWYgRHJhd0VRSW5kaWNhdG9ycyB0aGVuDQoJCURyYXdDaXJjbGUzRChtb3VzZVBvcy54LCBtb3VzZVBvcy55LCBtb3VzZVBvcy56LCAyMDAsIDMsIEdldERpc3RhbmNlVG9DbG9zZXN0SGVybyhtb3VzZVBvcykgPCAyMDAgKiAyMDAgYW5kIEFSR0IoMjAwLCAyNTUsIDAsIDApIG9yIEFSR0IoMjAwLCAwLCAyNTUsIDApLCAyMCktLXNvcnJ5IGZvciBjb2xvcmJsaW5kIHBlb3BsZSBEOg0KCWVuZA0KDQoJaWYgR2V0VGFyZ2V0KCkgYW5kIEdldFRhcmdldCgpLnR5cGUgPT0gJ29ial9BSV9NaW5pb24nIGFuZCBHZXRUYXJnZXQoKS50ZWFtID09IFRFQU1fTkVVVFJBTCB0aGVuDQoJCURyYXdDaXJjbGUzRChHZXRUYXJnZXQoKS54LCBHZXRUYXJnZXQoKS55LCBHZXRUYXJnZXQoKS56LCAxMDAsIDIsIE1lbnUuSnVuZ2xlRmFybS5FbmFibGVkIGFuZCBBUkdCKDE3NSwgMjU1LCAwLCAwKSBvciBBUkdCKDE3NSwgMCwgMjU1LCAwKSwgMjUpIC0tc29ycnkgZm9yIGNvbG9yYmxpbmQgcGVvcGxlIEQ6DQoJZW5kDQoNCglpZiBEcmF3SnVuZ2xlU3RlYWxpbmdJbmRpY2F0b3IgdGhlbg0KCQlsb2NhbCBwb3MgPSBHZXRFbmVteUhQQmFyUG9zKG15SGVybykgKyBWZWN0b3IoMjAsIC00KQ0KCQlwb3MueCA9IG1hdGguZmxvb3IocG9zLngpDQoJCXBvcy55ID0gbWF0aC5mbG9vcihwb3MueSkNCg0KCQlEcmF3VGV4dCh0b3N0cmluZygiSnVuZ2xlU3RlYWxpbmciKSwgMTYsIHBvcy54KzEsIHBvcy55KzEsIEFSR0IoMjU1LCAwLCAwLCAwKSkNCgkJRHJhd1RleHQodG9zdHJpbmcoIkp1bmdsZVN0ZWFsaW5nIiksIDE2LCBwb3MueCwgcG9zLnksIEFSR0IoMjU1LCAyNTUsIDI1NSwgMjU1KSkNCgllbmQNCg0KCWlmIE1lbnUuSGFyYXNzLkVuYWJsZWQyIHRoZW4NCgkJbG9jYWwgcG9zID0gR2V0RW5lbXlIUEJhclBvcyhteUhlcm8pICsgVmVjdG9yKDAsIC00KQ0KCQlwb3MueCA9IG1hdGguZmxvb3IocG9zLngpDQoJCXBvcy55ID0gbWF0aC5mbG9vcihwb3MueSkNCg0KCQlEcmF3VGV4dCh0b3N0cmluZygiQUgiKSwgMTYsIHBvcy54KzEsIHBvcy55KzEsIEFSR0IoMjU1LCAwLCAwLCAwKSkNCgkJRHJhd1RleHQodG9zdHJpbmcoIkFIIiksIDE2LCBwb3MueCwgcG9zLnksIEFSR0IoMjU1LCAyNTUsIDI1NSwgMjU1KSkNCgllbmQNCg0KCWlmIE1lbnUuTWlzYy5KdW5nbGVTdGVhbC5KU2RyYXcgdGhlbg0KCQlEcmF3Q2lyY2xlMihTcG90cy5CbHVlQmx1ZS54LCBTcG90cy5CbHVlQmx1ZS55LCBTcG90cy5CbHVlQmx1ZS56LCAyMDAsIEFSR0IoMjU1LCAwLCAyNTUsIDApKQ0KCQlEcmF3Q2lyY2xlMihTcG90cy5QdXJwbGVCbHVlLngsIFNwb3RzLlB1cnBsZUJsdWUueSwgU3BvdHMuUHVycGxlQmx1ZS56LCAyMDAsIEFSR0IoMjU1LCAwLCAyNTUsIDApKQ0KCWVuZA0KDQotLQlEcmF3VGV4dCgiVyBTdGF0dXM6ICIgLi5XLnN0YXR1cywgMTgsIDEwMCwgMTAwLCAweEZGRkZGRjAwKQ0KLS0JaWYgbm90IFdPYmplY3QgdGhlbiBEcmF3VGV4dCgiV29iamVjdCBOb3BlLiIsIDE4LCAxMDAsIDEyMCwgMHhGRkZGRkYwMCkgZW5kDQplbmQNCg0KDQpmdW5jdGlvbiBGYXJtKCkNCglpZiAoTWVudS5GYXJtLk1hbmFDaGVjayA+IChteUhlcm8ubWFuYSAvIG15SGVyby5tYXhNYW5hKSAqIDEwMCBhbmQgTWVudS5GYXJtLkxhbmVDbGVhcikgb3IgKE1lbnUuRmFybS5NYW5hQ2hlY2syID4gKG15SGVyby5tYW5hIC8gbXlIZXJvLm1heE1hbmEpICogMTAwIGFuZCBNZW51LkZhcm0uRnJlZXplKSB0aGVuIHJldHVybiBlbmQNCglFbmVteU1pbmlvbnM6dXBkYXRlKCkNCglsb2NhbCBVc2VRID0gTWVudS5GYXJtLkxhbmVDbGVhciBhbmQgKE1lbnUuRmFybS5Vc2VRID49IDMpIG9yIChNZW51LkZhcm0uVXNlUSA9PSAyIG9yIE1lbnUuRmFybS5Vc2VRID09IDQpDQoJbG9jYWwgVXNlVyA9IE1lbnUuRmFybS5MYW5lQ2xlYXIgYW5kIChNZW51LkZhcm0uVXNlVyA+PSAzKSBvciAoTWVudS5GYXJtLlVzZVcgPT0gMiBvciBNZW51LkZhcm0uVXNlVyA9PSA0KQ0KCWxvY2FsIFVzZUUgPSBNZW51LkZhcm0uTGFuZUNsZWFyIGFuZCAoTWVudS5GYXJtLlVzZUUgPj0gMykgb3IgKE1lbnUuRmFybS5Vc2VFID09IDIgb3IgTWVudS5GYXJtLlVzZUUgPT0gNCkNCg0KCWxvY2FsIENhc3Rlck1pbmlvbnMgPSBTZWxlY3RVbml0cyhFbmVteU1pbmlvbnMub2JqZWN0cywgZnVuY3Rpb24odCkgcmV0dXJuICh0LmNoYXJOYW1lOmxvd2VyKCk6ZmluZCgicmFuZ2UiKSBvciB0LmNoYXJOYW1lOmxvd2VyKCk6ZmluZCgic2llZ2UiKSkgYW5kIFZhbGlkVGFyZ2V0KHQpIGFuZCBHZXREaXN0YW5jZVNxcih0KSA8IFcucmFuZ2VTcXIgZW5kKQ0KCWxvY2FsIE1lbGVlTWluaW9ucyA9IFNlbGVjdFVuaXRzKEVuZW15TWluaW9ucy5vYmplY3RzLCBmdW5jdGlvbih0KSByZXR1cm4gKHQuY2hhck5hbWU6bG93ZXIoKTpmaW5kKCJtZWxlZSIpIG9yIHQuY2hhck5hbWU6bG93ZXIoKTpmaW5kKCJzdXBlciIpKSBhbmQgVmFsaWRUYXJnZXQodCkgYW5kIEdldERpc3RhbmNlU3FyKHQpIDwgVy5yYW5nZVNxciBlbmQpDQoNCglpZiBVc2VXIHRoZW4NCgkJaWYgVy5zdGF0dXMgPT0gMCB0aGVuDQoJCQlpZiAjTWVsZWVNaW5pb25zID4gMSB0aGVuDQoJCQkJQ2FzdFNwZWxsKF9XLCBNZWxlZU1pbmlvbnNbMV0ueCwgTWVsZWVNaW5pb25zWzFdLnopDQoJCQkJaWYgTWVudS5kZWJ1Zy5XZGVidWcuV0Nhc3RQcmludCB0aGVuIFByaW50Q2hhdCgiUGlja2VkIG1lbGVlIG1pbmlvbiB3aXRoIFciKSBlbmQNCgkJCWVsc2VpZiAjQ2FzdGVyTWluaW9ucyA+IDEgdGhlbg0KCQkJCUNhc3RTcGVsbChfVywgQ2FzdGVyTWluaW9uc1sxXS54LCBDYXN0ZXJNaW5pb25zWzFdLnopDQoJCQkJaWYgTWVudS5kZWJ1Zy5XZGVidWcuV0Nhc3RQcmludCB0aGVuIFByaW50Q2hhdCgiUGlja2VkIGNhc3RlciBtaW5pb24gd2l0aCBXIikgZW5kDQoJCQllbmQNCgkJZWxzZQ0KCQkJbG9jYWwgQmVzdFBvczEsIEJlc3RIaXQxID0gR2V0QmVzdENpcmN1bGFyRmFybVBvc2l0aW9uKFcucmFuZ2UsIFcud2lkdGgsIENhc3Rlck1pbmlvbnMpDQoJCQlsb2NhbCBCZXN0UG9zMiwgQmVzdEhpdDIgPSBHZXRCZXN0Q2lyY3VsYXJGYXJtUG9zaXRpb24oVy5yYW5nZSwgVy53aWR0aCwgTWVsZWVNaW5pb25zKQ0KDQoJCQlpZiBCZXN0SGl0MSA+IDIgb3IgKEJlc3RQb3MxIGFuZCAjQ2FzdGVyTWluaW9ucyA8PSAyKSB0aGVuDQoJCQkJQ2FzdFNwZWxsKF9XLCBCZXN0UG9zMS54LCBCZXN0UG9zMS56KQ0KCQkJCWlmIE1lbnUuZGVidWcuV2RlYnVnLldDYXN0UHJpbnQgdGhlbiBQcmludENoYXQoIlRocm93biBtaW5pb24gb24gQ2FzdGVyIE1pbmlvbnMgd2l0aCBXIikgZW5kDQoJCQllbHNlaWYgQmVzdEhpdDIgPiAyIG9yIChCZXN0UG9zMiBhbmQgI01lbGVlTWluaW9ucyA8PSAyKSB0aGVuDQoJCQkJQ2FzdFNwZWxsKF9XLCBCZXN0UG9zMi54LCBCZXN0UG9zMi56KQ0KCQkJCWlmIE1lbnUuZGVidWcuV2RlYnVnLldDYXN0UHJpbnQgdGhlbiBQcmludENoYXQoIlRocm93biBtaW5pb24gb24gTWVsZWUgTWluaW9ucyB3aXRoIFciKSBlbmQNCgkJCWVuZA0KDQoJCWVuZA0KCWVuZA0KDQoJaWYgVXNlUSB0aGVuDQoJCUNhc3Rlck1pbmlvbnMgPSBHZXRQcmVkaWN0ZWRQb3NpdGlvbnNUYWJsZShWUCwgQ2FzdGVyTWluaW9ucywgUS5kZWxheSwgUS53aWR0aCwgUS5yYW5nZSArIFEud2lkdGgsIG1hdGguaHVnZSwgbXlIZXJvLCBmYWxzZSkNCgkJTWVsZWVNaW5pb25zID0gR2V0UHJlZGljdGVkUG9zaXRpb25zVGFibGUoVlAsIE1lbGVlTWluaW9ucywgUS5kZWxheSwgUS53aWR0aCwgUS5yYW5nZSArIFEud2lkdGgsIG1hdGguaHVnZSwgbXlIZXJvLCBmYWxzZSkNCg0KCQlsb2NhbCBCZXN0UG9zMSwgQmVzdEhpdDEgPSBHZXRCZXN0Q2lyY3VsYXJGYXJtUG9zaXRpb24oUS5yYW5nZSArIFEud2lkdGgsIFEud2lkdGgsIENhc3Rlck1pbmlvbnMpDQoJCWxvY2FsIEJlc3RQb3MyLCBCZXN0SGl0MiA9IEdldEJlc3RDaXJjdWxhckZhcm1Qb3NpdGlvbihRLnJhbmdlICsgUS53aWR0aCwgUS53aWR0aCwgTWVsZWVNaW5pb25zKQ0KDQoJCWlmIEJlc3RQb3MxIGFuZCBCZXN0SGl0MSA+PSAxIHRoZW4NCgkJCUNhc3RTcGVsbChfUSwgQmVzdFBvczEueCwgQmVzdFBvczEueikNCgkJCWlmIE1lbnUuZGVidWcuUWRlYnVnLlFDYXN0UHJpbnQgdGhlbiBQcmludENoYXQoIkNhc3RlZCBRIG9uIENhc3RlciBNaW5pb25zIikgZW5kDQoJCWVsc2VpZiBCZXN0UG9zMiBhbmQgQmVzdEhpdDIgPj0gMSB0aGVuDQoJCQlDYXN0U3BlbGwoX1EsIEJlc3RQb3MyLngsIEJlc3RQb3MyLnopDQoJCQlpZiBNZW51LmRlYnVnLlFkZWJ1Zy5RQ2FzdFByaW50IHRoZW4gUHJpbnRDaGF0KCJDYXN0ZWQgUSBvbiBNZWxlZSBNaW5pb25zIikgZW5kDQoJCWVuZA0KCWVuZA0KDQoJaWYgVXNlRSBhbmQgKG5vdCBRLklzUmVhZHkoKSBvciBub3QgVXNlUSkgdGhlbg0KCQlsb2NhbCBBbGxNaW5pb25zID0gU2VsZWN0VW5pdHMoRW5lbXlNaW5pb25zLm9iamVjdHMsIGZ1bmN0aW9uKHQpIHJldHVybiBWYWxpZFRhcmdldCh0KSBhbmQgR2V0RGlzdGFuY2VTcXIodCkgPCBFLnJhbmdlU3FyIGVuZCkNCgkJbG9jYWwgQmVzdFBvcywgQmVzdEhpdCA9IEdldEJlc3RDaXJjdWxhckZhcm1Qb3NpdGlvbihFLnJhbmdlLCBFLndpZHRoLCBBbGxNaW5pb25zKQ0KCQlpZiBCZXN0SGl0ID4gNCB0aGVuDQoJCQlDYXN0U3BlbGwoX0UsIEJlc3RQb3MueCwgQmVzdFBvcy56KQ0KCQkJaWYgTWVudS5kZWJ1Zy5FZGVidWcuRUNhc3RQcmludCB0aGVuIFByaW50Q2hhdCgiQ2FzdGVkIEUgb24gTWluaW9ucyIpIGVuZA0KCQllbHNlDQoJCQlsb2NhbCB2YWxpZGJhbGxzID0gR2V0VmFsaWRCYWxscygpDQoJCQlsb2NhbCBtYXhjb3VudCA9IDANCgkJCWxvY2FsIG1heHBvcw0KDQoJCQlmb3IgaSwgYmFsbCBpbiBpcGFpcnModmFsaWRiYWxscykgZG8NCgkJCQlpZiBHZXREaXN0YW5jZVNxcihiYWxsLm9iamVjdCwgbXlIZXJvLnZpc2lvblBvcykgPCBRLnJhbmdlU3FyIHRoZW4NCgkJCQkJbG9jYWwgQ291bnQgPSAwDQoJCQkJCWZvciBpLCBtaW5pb24gaW4gaXBhaXJzKEFsbE1pbmlvbnMpIGRvDQoJCQkJCQlsb2NhbCBFUCA9IFZlY3RvcihiYWxsLm9iamVjdCkgKyAgKDEwMCsoLTAuNiAqIEdldERpc3RhbmNlKGJhbGwub2JqZWN0LCBteUhlcm8udmlzaW9uUG9zKSArIDk2NikpICogKFZlY3RvcihiYWxsLm9iamVjdCkgLSBWZWN0b3IobXlIZXJvLnZpc2lvblBvcykpOm5vcm1hbGl6ZWQoKQ0KCQkJCQkJbG9jYWwgU1AgPSBWZWN0b3IobXlIZXJvLnZpc2lvblBvcykNCgkJCQkJCWxvY2FsIHBvaW50U2VnbWVudCwgcG9pbnRMaW5lLCBpc09uU2VnbWVudCA9IFZlY3RvclBvaW50UHJvamVjdGlvbk9uTGluZVNlZ21lbnQoU1AsIEVQLCBtaW5pb24pDQoJCQkJCQlpZiBpc09uU2VnbWVudCBhbmQgR2V0RGlzdGFuY2VTcXIocG9pbnRMaW5lLCBlbmVteVBvcykgPCBRRS53aWR0aCAqIFFFLndpZHRoIHRoZW4NCgkJCQkJCQlDb3VudCA9IENvdW50ICsgMQ0KCQkJCQkJZW5kDQoJCQkJCWVuZA0KCQkJCQlpZiBDb3VudCA+IG1heGNvdW50IHRoZW4NCgkJCQkJCW1heGNvdW50ID0gQ291bnQNCgkJCQkJCW1heHBvcyA9IFZlY3RvcihiYWxsLm9iamVjdCkNCgkJCQkJZW5kDQoJCQkJZW5kDQoJCQllbmQNCgkJCWlmIG1heGNvdW50ID4gMiB0aGVuDQoJCQkJQ2FzdFNwZWxsKF9FLCBtYXhwb3MueCwgbWF4cG9zLnopDQoJCQkJaWYgTWVudS5kZWJ1Zy5FZGVidWcuRUNhc3RQcmludCB0aGVuIFByaW50Q2hhdCgiQ2FzdGVkIEUgb24gTWluaW9ucyIpIGVuZA0KCQkJZW5kDQoJCWVuZA0KCWVuZA0KZW5kDQoNCmZ1bmN0aW9uIEp1bmdsZUZhcm0oKQ0KCUp1bmdsZU1pbmlvbnM6dXBkYXRlKCkNCglsb2NhbCBVc2VRID0gTWVudS5KdW5nbGVGYXJtLlVzZVENCglsb2NhbCBVc2VXID0gTWVudS5KdW5nbGVGYXJtLlVzZVcNCglsb2NhbCBVc2VFID0gTWVudS5KdW5nbGVGYXJtLlVzZUUNCglsb2NhbCBXVXNlZCA9IGZhbHNlDQoJbG9jYWwgQ2xvc2VNaW5pb25zID0gU2VsZWN0VW5pdHMoSnVuZ2xlTWluaW9ucy5vYmplY3RzLCBmdW5jdGlvbih0KSByZXR1cm4gR2V0RGlzdGFuY2VTcXIodCkgPD0gVy5yYW5nZVNxciBhbmQgVmFsaWRUYXJnZXQodCkgZW5kKQ0KCWxvY2FsIEFsbE1pbmlvbnMgPSBTZWxlY3RVbml0cyhKdW5nbGVNaW5pb25zLm9iamVjdHMsIGZ1bmN0aW9uKHQpIHJldHVybiBWYWxpZFRhcmdldCh0KSBlbmQpDQoNCglsb2NhbCBDbG9zZU1pbmlvbiA9IENsb3NlTWluaW9uc1sxXQ0KCWxvY2FsIEZhck1pbmlvbiA9IEFsbE1pbmlvbnNbMV0NCg0KDQoNCglpZiBWYWxpZFRhcmdldChDbG9zZU1pbmlvbikgdGhlbg0KCQlsb2NhbCBzZWxlY3RlZFRhcmdldCA9IEdldFRhcmdldCgpDQoNCgkJaWYgc2VsZWN0ZWRUYXJnZXQgYW5kIHNlbGVjdGVkVGFyZ2V0LnR5cGUgPT0gQ2xvc2VNaW5pb24udHlwZSB0aGVuDQoJCQlEcmF3SnVuZ2xlU3RlYWxpbmdJbmRpY2F0b3IgPSB0cnVlDQoJCQlTeE9yYjpEaXNhYmxlQXR0YWNrcygpDQoJCQlpZiBWYWxpZFRhcmdldChzZWxlY3RlZFRhcmdldCkgYW5kIERMaWI6SXNLaWxsYWJsZShzZWxlY3RlZFRhcmdldCwge19RLCBfV30pIGFuZCBHZXREaXN0YW5jZVNxcihteUhlcm8udmlzaW9uUG9zLCBzZWxlY3RlZFRhcmdldCkgPD0gVy5yYW5nZVNxciBhbmQgVy5Jc1JlYWR5KCkgdGhlbg0KCQkJCWlmIFcuc3RhdHVzID09IDAgdGhlbg0KCQkJCQlDYXN0U3BlbGwoX1csIHNlbGVjdGVkVGFyZ2V0LngsIHNlbGVjdGVkVGFyZ2V0LnopDQoJCQkJCWlmIE1lbnUuZGVidWcuV2RlYnVnLldDYXN0UHJpbnQgdGhlbiBQcmludENoYXQoIlBpY2tlZCBKdW5nbGUgTW9uc3RlciB3aXRoIFciKSBlbmQNCgkJCQllbmQNCgkJCWVuZA0KCQllbHNlDQoJCQlpZiBVc2VXIHRoZW4NCgkJCQlpZiBXLnN0YXR1cyA9PSAwIHRoZW4NCgkJCQkJbG9jYWwgdmFsaWRiYWxsID0gR2V0V1ZhbGlkQmFsbCh0cnVlKQ0KCQkJCQlpZiB2YWxpZGJhbGwgYW5kIHZhbGlkYmFsbC5hZGRlZCB0aGVuDQoJCQkJCQlDYXN0U3BlbGwoX1csIHZhbGlkYmFsbC5vYmplY3QueCwgdmFsaWRiYWxsLm9iamVjdC56KQ0KCQkJCQkJaWYgTWVudS5kZWJ1Zy5XZGVidWcuV0Nhc3RQcmludCB0aGVuIFByaW50Q2hhdCgiUGlja2VkIGJhbGwgd2l0aCBXIikgZW5kDQoJCQkJCQlXVXNlZCA9IHRydWUNCgkJCQkJZW5kDQoJCQkJZWxzZQ0KCQkJCQlDYXN0U3BlbGwoX1csIENsb3NlTWluaW9uKQ0KCQkJCQlpZiBNZW51LmRlYnVnLldkZWJ1Zy5XQ2FzdFByaW50IHRoZW4gUHJpbnRDaGF0KCJUaHJvd24gSnVuZ2xlIE1vbnN0ZXIgd2l0aCBXIikgZW5kDQoJCQkJCVdVc2VkID0gdHJ1ZQ0KCQkJCWVuZA0KCQkJZW5kDQoNCgkJCWlmIFVzZVEgdGhlbg0KCQkJCUNhc3RTcGVsbChfUSwgQ2xvc2VNaW5pb24pDQoJCQkJaWYgTWVudS5kZWJ1Zy5RZGVidWcuUUNhc3RQcmludCB0aGVuIFByaW50Q2hhdCgiQ2FzdGVkIFEgb24gSnVuZ2xlIE1vbnN0ZXIiKSBlbmQNCgkJCWVuZA0KDQoJCQlpZiBVc2VFIGFuZCBvcy5jbG9jaygpIC0gUS5MYXN0Q2FzdFRpbWUgPiAxIHRoZW4NCgkJCQlDYXN0U3BlbGwoX0UsIENsb3NlTWluaW9uKQ0KCQkJCWlmIE1lbnUuZGVidWcuRWRlYnVnLkVDYXN0UHJpbnQgdGhlbiBQcmludENoYXQoIkNhc3RlZCBFIG9uIEp1bmdsZSBNb25zdGVyIikgZW5kDQoJCQllbmQNCgkJZW5kDQoJZWxzZWlmIFZhbGlkVGFyZ2V0KEZhck1pbmlvbikgYW5kIEdldERpc3RhbmNlU3FyKEZhck1pbmlvbikgPD0gKFEucmFuZ2UgKyA1ODgpXjIgYW5kIEdldERpc3RhbmNlU3FyKEZhck1pbmlvbikgPiBRLnJhbmdlU3FyIGFuZCBETGliOklzS2lsbGFibGUoRmFyTWluaW9uLCB7X0V9KSB0aGVuDQoJCWlmIFEuSXNSZWFkeSgpIGFuZCBFLklzUmVhZHkoKSB0aGVuDQoJCQlsb2NhbCBRUG9zID0gVmVjdG9yKG15SGVyby52aXNpb25Qb3MpICsgUS5yYW5nZSAqIChWZWN0b3IoRmFyTWluaW9uKSAtIFZlY3RvcihteUhlcm8pKTpub3JtYWxpemVkKCkNCgkJCUNhc3RTcGVsbChfUSwgUVBvcy54LCBRUG9zLnopDQoJCQlpZiBNZW51LmRlYnVnLlFkZWJ1Zy5RQ2FzdFByaW50IHRoZW4gUHJpbnRDaGF0KCJDYXN0ZWQgUSBvbiBmYXIgSnVuZ2xlIE1vbnN0ZXIiKSBlbmQNCgkJCVFFQ29tYm8gPSBvcy5jbG9jaygpDQoJCWVuZA0KCWVuZA0KDQoJaWYgVy5zdGF0dXMgPT0gMSBhbmQgbm90IFdVc2VkIHRoZW4NCi0tCQlpZiAobm90IFdPYmplY3QubmFtZSBvciBub3QgV09iamVjdC5uYW1lOmZpbmQoIlNlZWQiKSkgYW5kIFdPYmplY3QudHlwZSA9PSAnb2JqX0FJX01pbmlvbicgdGhlbg0KCQlDYXN0U3BlbGwoX1csIENsb3NlTWluaW9uKQ0KCQlpZiBNZW51LmRlYnVnLldkZWJ1Zy5XQ2FzdFByaW50IHRoZW4gUHJpbnRDaGF0KCJUaHJvd24gSnVuZ2xlIE1vbnN0ZXIgb24gbXlzZWxmIikgZW5kDQoJZW5kDQplbmQNCg0KZnVuY3Rpb24gWmhvbnlhcygpDQoJaWYgTWVudS5NaXNjLlpob255YS5lbmFibGVkIHRoZW4NCgkJaWYgR2V0SW52ZW50b3J5SGF2ZUl0ZW0oMzE1NykgYW5kIEdldEludmVudG9yeUl0ZW1Jc0Nhc3RhYmxlKDMxNTcpIHRoZW4NCgkJCWlmIG15SGVyby5oZWFsdGggPD0gIG15SGVyby5tYXhIZWFsdGggKiAoTWVudS5NaXNjLlpob255YS56aG9ueWFwbHMgLyAxMDApIHRoZW4NCgkJCQlDYXN0SXRlbSgzMTU3KQ0KCQkJZW5kDQoJCWVuZA0KCWVuZA0KZW5kDQoNCmZ1bmN0aW9uIEp1bmdsZVN0ZWFsKCkNCg0KCWxvY2FsIEJsdWUgPSBTZWxlY3RVbml0cyhKdW5nbGVNaW5pb25zLm9iamVjdHMsIGZ1bmN0aW9uKHQpIHJldHVybiB0LmNoYXJOYW1lOmxvd2VyKCk6ZmluZCgiYmx1ZSIpIGFuZCBWYWxpZFRhcmdldCh0KSBlbmQpDQoNCglpZiBHZXREaXN0YW5jZShTcG90cy5QdXJwbGVCbHVlKSA8PSAyNSBhbmQgTWVudS5NaXNjLkp1bmdsZVN0ZWFsLmVuYWJsZWQgdGhlbg0KCQlpZiBXLnN0YXR1cyA9PSAwIGFuZCBXLklzUmVhZHkoKSBhbmQgUS5Jc1JlYWR5KCkgdGhlbg0KCQkJaWYgVmFsaWRUYXJnZXQoQmx1ZSkgdGhlbg0KCQkJCUNhc3RTcGVsbChfVywgQmx1ZS54LCBCbHVlLnopDQoJCQkJaWYgVy5zdGF0dXMgPT0gMSB0aGVuDQoJCQkJCUNhc3RTcGVsbChfVywgbXlIZXJvLngsIG15SGVyby56KQ0KCQkJCQlDYXN0U3BlbGwoX1EsIEJsdWUueCwgQmx1ZS56KQ0KCQkJCWVuZA0KCQkJZW5kDQoJCWVuZA0KCWVsc2VpZiBHZXREaXN0YW5jZShTcG90cy5QdXJwbGVCbHVlKSA+IDI1IGFuZCBHZXREaXN0YW5jZShTcG90cy5QdXJwbGVCbHVlLCBtb3VzZVBvcykgPCAyMjUgdGhlbg0KCQlteUhlcm86TW92ZVRvKFNwb3RzLlB1cnBsZUJsdWUueCwgU3BvdHMuUHVycGxlQmx1ZS56KQ0KCWVuZA0KZW5kDQoNCi0tIEJhcmFzaWEsIHZhZGFzaCwgdmlzZXZlcnNhDQpmdW5jdGlvbiBEcmF3Q2lyY2xlTmV4dEx2bCh4LCB5LCB6LCByYWRpdXMsIHdpZHRoLCBjb2xvciwgY2hvcmRsZW5ndGgpDQoJcmFkaXVzID0gcmFkaXVzIG9yIDMwMA0KCXF1YWxpdHkgPSBtYXRoLm1heCg4LHJvdW5kKDE4MC9tYXRoLmRlZygobWF0aC5hc2luKChjaG9yZGxlbmd0aC8oMipyYWRpdXMpKSkpKSkpDQoJcXVhbGl0eSA9IDIgKiBtYXRoLnBpIC8gcXVhbGl0eQ0KCXJhZGl1cyA9IHJhZGl1cyouOTINCglsb2NhbCBwb2ludHMgPSB7fQ0KCWZvciB0aGV0YSA9IDAsIDIgKiBtYXRoLnBpICsgcXVhbGl0eSwgcXVhbGl0eSBkbw0KCQlsb2NhbCBjID0gV29ybGRUb1NjcmVlbihEM0RYVkVDVE9SMyh4ICsgcmFkaXVzICogbWF0aC5jb3ModGhldGEpLCB5LCB6IC0gcmFkaXVzICogbWF0aC5zaW4odGhldGEpKSkNCgkJcG9pbnRzWyNwb2ludHMgKyAxXSA9IEQzRFhWRUNUT1IyKGMueCwgYy55KQ0KCWVuZA0KCURyYXdMaW5lczIocG9pbnRzLCB3aWR0aCBvciAxLCBjb2xvciBvciA0Mjk0OTY3Mjk1KQ0KZW5kDQoNCmZ1bmN0aW9uIHJvdW5kKG51bSkNCglpZiBudW0gPj0gMCB0aGVuIHJldHVybiBtYXRoLmZsb29yKG51bSsuNSkgZWxzZSByZXR1cm4gbWF0aC5jZWlsKG51bS0uNSkgZW5kDQplbmQNCg0KZnVuY3Rpb24gRHJhd0NpcmNsZTIoeCwgeSwgeiwgcmFkaXVzLCBjb2xvcikNCglsb2NhbCB2UG9zMSA9IFZlY3Rvcih4LCB5LCB6KQ0KCWxvY2FsIHZQb3MyID0gVmVjdG9yKGNhbWVyYVBvcy54LCBjYW1lcmFQb3MueSwgY2FtZXJhUG9zLnopDQoJbG9jYWwgdFBvcyA9IHZQb3MxIC0gKHZQb3MxIC0gdlBvczIpOm5vcm1hbGl6ZWQoKSAqIHJhZGl1cw0KCWxvY2FsIHNQb3MgPSBXb3JsZFRvU2NyZWVuKEQzRFhWRUNUT1IzKHRQb3MueCwgdFBvcy55LCB0UG9zLnopKQ0KCWlmIE9uU2NyZWVuKHsgeCA9IHNQb3MueCwgeSA9IHNQb3MueSB9LCB7IHggPSBzUG9zLngsIHkgPSBzUG9zLnkgfSkgdGhlbg0KCQlEcmF3Q2lyY2xlTmV4dEx2bCh4LCB5LCB6LCByYWRpdXMsIDEsIGNvbG9yLCA4MCkNCgllbmQNCmVuZA0K"),nil,b,_ENV)()
